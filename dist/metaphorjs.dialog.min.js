(function(){function ha(c){if(null===c||"object"!=typeof c)return!1;c=ia(c);return 2<c||-1==c}function u(c){return"function"==typeof c}function z(c){return"string"===typeof c||c===""+c}function S(c){return"object"===typeof c&&5===ia(c)}function Z(c){if(c&&void 0!=!c.length&&c!==""+c){for(var a=[],b=-1,d=c.length>>>0;++b!==d;a[b]=c[b]);return a}return c?[c]:[]}function ca(c){return"object"==typeof c&&3===ia(c)&&!c.nodeType&&c.constructor===Object}function ja(c){return!0===c||!1===c}function A(){var c=
!1,a=!1,b=Z(arguments),d=b.shift(),f,k,g;ja(b[b.length-1])&&(c=b.pop());ja(b[b.length-1])&&(a=c,c=b.pop());for(;f=b.shift();)for(k in f)if(f.hasOwnProperty(k)&&void 0!==(g=f[k]))if(a)if(d[k]&&ca(d[k])&&ca(g))A(d[k],g,c,a);else{if(!0===c||void 0==d[k])ca(g)?(d[k]={},A(d[k],g,c,!0)):d[k]=g}else if(!0===c||void 0==d[k])d[k]=g;return d}function O(){}function Fa(c,a){var b=function(){};b.prototype=c.prototype;b=new b;c=c.apply(b,a);return ha(c)||!1===c?c:b}function Ga(c,a,b,d,f,k){f=f||"before";return function(){if("instead"==
f)return a.apply(b||d,arguments);if("before"==f){var g=a.apply(b||d,arguments);var e=!1!==g?c.apply(d||b,arguments):null}else e=c.apply(d||b,arguments),g=a.apply(b||d,arguments);return k?g:e}}function I(c,a,b,d){return setTimeout(function(){c.apply(a,b||[])},d||0)}function ua(c,a){if(!c||!z(c))return null;try{var b=new DOMParser;var d=b.parseFromString(c,a||"text/xml")}catch(f){M(f),d=void 0}if(!d||d.getElementsByTagName("parsererror").length)throw Error("Invalid XML: "+c);return d}function U(c){if(!c)return!1;
var a;if("object"!=(a=typeof c)&&"function"!=a)return!1;c=c.then;return u(c)?c:!1}function ka(){return!1}function la(){return!0}function W(c){return c.substr(0,1).toUpperCase()+c.substr(1)}var m={plugin:{},mixin:{},lib:{},dom:{},regexp:{},browser:{}},pa=m.lib.Cache=function(){var c,a=function(a){var d={},b=[];0==arguments.length&&(a=!0);return{addFinder:function(a,d,e){b[e?"unshift":"push"]({fn:a,context:d})},add:function(b,f,e){if(d[b]&&!1===d[b].rewritable)return d[b];d[b]={rewritable:"undefined"!=
typeof e?e:a,value:f};return f},get:function(a,f){if(!d[a]){if(b.length){var e;var h=0;for(e=b.length;h<e;h++){var c=b[h].fn.call(b[h].context,a,this);if(void 0!==c)return this.add(a,c,!0)}}return void 0!==f?this.add(a,f):void 0}return d[a].value},remove:function(a){var b=d[a];b&&!0===b.rewritable&&delete d[a];return b?b.value:void 0},exists:function(a){return!!d[a]},eachEntry:function(a,b){for(var e in d)a.call(b,d[e].value,e)},clear:function(){d={}},$destroy:function(){this===c&&(c=null);this.remove=
this.exists=this.destroy=this.get=this.add=a=d=null}}};a.global=function(){c||(c=new a(!0));return c};return a}(),Ha=Object.prototype.toString,ia=function(){var c={"[object String]":0,"[object Number]":1,"[object Boolean]":2,"[object Object]":3,"[object Function]":4,"[object Array]":5,"[object RegExp]":9,"[object Date]":10};return function(a){if(!a){if(null===a)return 6;if(void 0===a)return 7}var b=c[Ha.call(a)];return void 0===b?-1:1===b&&isNaN(a)?8:b}}(),qa=m.lib.Namespace=function(c){c=c||{};var a=
new pa(!1),b=function(b,f){var d=a.get(b);if(void 0!==d||f)return d;f=b.split(".");var g=f.length,e=c;for(d=0;d<g;d++){var h=f[d];if(void 0===e[h])return;e=e[h]}e&&a.add(b,e);return e};this.register=function(b,f){var d=b.split("."),g=d.pop();var e=d.join(".");var h=d.length,l=c;if(a[e])b=[a[e],g,b];else{if(0<h)for(e=0;e<h;e++){var n=d[e];void 0===l[n]&&(l[n]={});l=l[n]}b=[l,g,b]}d=b[0];g=b[1];ha(d)&&void 0===d[g]&&(d[g]=f,a.add(b[2],f));return f};this.exists=function(a){return void 0!==b(va,!0)};
this.get=b;this.add=function(b,f){return a.add(b,f)};this.remove=function(b){return a.remove(b)};this.makeAlias=function(b,f){b=a.get(b);void 0!==b&&a.add(f,b);return b};this.$destroy=function(){var b;a.eachEntry(function(a){a&&a.$destroy&&a.$destroy()});a.$destroy();a=null;for(b in this)this[b]=null}},P=function(){var c=function(){this.$super&&this.$super!==O&&this.$super.apply(this,arguments)},a=function(a,b,d){var $super=a.prototype[b]||("$constructor"===b?a:O)||O;return function(){var a=this.$super;
if(this.$destroyed)return this.$super=null;this.$super=$super;var b=d.apply(this,arguments);this.$super=a;return b}},b=function(b,d,c,e){var h,f=c.prototype;for(h in d)if(d.hasOwnProperty(h)){var g=f[h];var q=d[h];b[h]=!u(q)||g&&!u(g)?q:a(c,h,q)}e||(b.$plugins=null,b.$pluginMap=null,f.$beforeInit?(b.$beforeInit=f.$beforeInit.slice(),b.$afterInit=f.$afterInit.slice(),b.$beforeDestroy=f.$beforeDestroy.slice(),b.$afterDestroy=f.$afterDestroy.slice()):(b.$beforeInit=[],b.$afterInit=[],b.$beforeDestroy=
[],b.$afterDestroy=[]))},d=function(a){a||(a=new qa);var f=function(e){return function(){var b=[],d=[],h=arguments,c,f;if(!this)throw Error("Must instantiate via new: "+e);this.$plugins=[];(c=this.$constructor.apply(this,arguments))&&S(c)&&(h=c);var l=this.$plugins;var g=this.$pluginMap={};c=-1;for(f=this.$beforeInit.length;++c<f;b.push([this.$beforeInit[c],this]));c=-1;for(f=this.$afterInit.length;++c<f;d.push([this.$afterInit[c],this]));if(l&&l.length)for(c=0,f=l.length;c<f;c++){var k=l[c];if(z(k)){var m=
k;k=a?a.get(k,!0):null;if(!k)throw m+" not found";}k=new k(this,h);g[k.$class]=k;k.$beforeHostInit&&b.push([k.$beforeHostInit,k]);k.$afterHostInit&&d.push([k.$afterHostInit,k]);l[c]=k}c=-1;for(f=b.length;++c<f;b[c][0].apply(b[c][1],h));this.$init&&this.$init.apply(this,h);c=-1;for(f=d.length;++c<f;d[c][0].apply(d[c][1],h));}},g=function(){};A(g.prototype,{$class:null,$extends:null,$plugins:null,$pluginMap:null,$mixins:null,$destroyed:!1,$destroying:!1,$constructor:O,$init:O,$beforeInit:[],$afterInit:[],
$beforeDestroy:[],$afterDestroy:[],$getClass:function(){return this.$class},$is:function(a){return h(this,a)},$getParentClass:function(){return this.$extends},$intercept:function(a,e,b,d,h){var c=this[a];this[a]=Ga(c||O,e,b||this,this,d,h);return c||O},$implement:function(a){var e=this.constructor;e&&e.$parent&&b(this,a,e.$parent,!0)},$hasPlugin:function(a){return a?!!this.$pluginMap[a]:!1},$getPlugin:function(a){return a?this.$pluginMap[a]||null:null},$bind:function(a){var e=this;return function(){if(!e.$isDestroyed())return a.apply(e,
arguments)}},$isDestroyed:function(){return self.$destroying||self.$destroyed},$destroy:function(){var a=this.$beforeDestroy,e=this.$afterDestroy,b=this.$plugins,d;if(!this.$destroying&&!this.$destroyed){this.$destroying=!0;var h=-1;for(d=a.length;++h<d;a[h].apply(this,arguments));h=0;for(d=b.length;h<d;h++)b[h].$beforeHostDestroy&&b[h].$beforeHostDestroy.call(b[h],arguments);a=this.onDestroy.apply(this,arguments);h=-1;for(d=e.length;++h<d;e[h].apply(this,arguments));h=0;for(d=b.length;h<d;h++)b[h].$destroy.apply(b[h],
arguments);if(!1!==a)for(h in this)this.hasOwnProperty(h)&&(this[h]=null);this.$destroying=!1;this.$destroyed=!0}},onDestroy:function(){}});g.$self=g;g.$instantiate=function(){var a=arguments;switch(a.length){case 0:return new this;case 1:return new this(a[0]);case 2:return new this(a[0],a[1]);case 3:return new this(a[0],a[1],a[2]);case 4:return new this(a[0],a[1],a[2],a[3]);default:return Fa(this,a)}};g.$override=function(a){var e=this.$self,d=this.$parent;e&&d&&b(e.prototype,a,d)};g.$extend=function(a,
b){return e(a,b,this)};g.$destroy=function(){for(var a in this)this[a]=null};var e=function(e,d,h){e=e||{};var l=e.$class,n=h||e.$extends,k=e.$mixins;h=e.$alias;var q,w;if(n)if(z(n))var m=a.get(n);else m=n,n=m.$class||"";else m=g,n="";if(n&&!m)throw n+" not found";e.$class=l;e.$extends=n;e.$mixins=null;n=Object.create(m.prototype);e.$constructor=e.$constructor||c;b(n,e,m);if(k)for(e=0,q=k.length;e<q;e++){var r=k[e];if(z(r)){if(!a)throw Error("Mixin "+r+" not found");r=a.get(r,!0)}var y=void 0,C=n;
for(y in r)r.hasOwnProperty(y)&&("$beforeInit"===y?C.$beforeInit.push(r[y]):"$afterInit"===y?C.$afterInit.push(r[y]):"$beforeDestroy"===y?C.$beforeDestroy.push(r[y]):"$afterDestroy"===y?C.$afterDestroy.push(r[y]):C[y]||(C[y]=r[y]))}k=f(l);n.constructor=k;n.$self=k;k.prototype=n;for(w in g)"prototype"!==w&&g.hasOwnProperty(w)&&(k[w]=g[w]);for(w in m)"prototype"!==w&&m.hasOwnProperty(w)&&(k[w]=m[w]);if(d)for(w in d)"prototype"!==w&&d.hasOwnProperty(w)&&(k[w]=d[w]);k.$parent=m;k.$self=k;a&&(l&&a.register(l,
k),h&&a.register(h,k));return k},h=function(e,b){return(b=z(b)&&a?a.get(b):b)?e instanceof b:!1};e.classManagerFactory=d;e.factory=function(e){var b=a?a.get(e):null,d=Z(arguments).slice(1);if(!b)throw e+" not found";return b.$instantiate.apply(b,d)};e.isSubclassOf=function(e,b){var d=e,h=a?a.get:function(){};z(b)||(b=b.prototype.$class);for(z(e)&&(d=h(e));d&&d.prototype;){if(d.prototype.$class===b)return!0;d=d.$parent}return!1};e.isInstanceOf=h;e.define=e;e.Namespace=qa;e.BaseClass=g;e.ns=a;e.$destroy=
function(){g.$destroy();g=null;a&&(a.$destroy(),a=null)};return e};return d}(),va=function(){var c=new qa;c.register("MetaphorJs",m);c.register("mjs",m);return c}(),J=P(va),fa=function(){var c=["0","0","0"];return function(){for(var a=c.length,b;a;){a--;b=c[a].charCodeAt(0);if(57==b)return c[a]="A",c.join("");if(90==b)c[a]="0";else return c[a]=String.fromCharCode(b+1),c.join("")}c.unshift("0");return c.join("")}}();m.dom=m.dom||{};var t=m.dom.getAttr=function(c,a){return c.getAttribute?c.getAttribute(a):
null},M=function(){var c=[],a=function(a){var b;var f=0;for(b=c.length;f<b;f++)c[f][0].call(c[f][1],a);"undefined"!=typeof console&&console.error&&console.error(a)};a.on=function(b,d){a.un(b,d);c.push([b,d])};a.un=function(a,d){var b;var k=0;for(b=c.length;k<b;k++)if(c[k][0]===a&&c[k][1]===d){c.splice(k,1);break}};return a}(),K=m.dom.select=function(){var c=/^[\w[:#.][\w\]*^|=!]*$/,a=/=([^\]]+)/,b=/ *, */,d=/(\([^)]*)\+/,f=/(\[[^\]]+)~/,k=/(~|>|\+)/,g=/ +/,e=/([^[:.#]+)?(?:#([^[:.#]+))?(?:\.([^[:.]+))?(?:\[([^!&^*|$[:=]+)([!$^*|&]?=)?([^:\]]+)?\])?(?::([^(]+)(?:\(([^)]+)\))?)?/,
h=/(?:(-?\d*)n)?(?:(%|-)(\d*))?/,l=/\D/,n=/[^(]*\(([^)]*)\)/,q=/\(.*/,p=/\[([^!~^*|$ [:=]+)([$^*|]?=)?([^ :\]]+)?\]/,B=window.document,x=!!B.getElementsByClassName,m=!!B.querySelectorAll,w={"first-child":function(a){return a.parentNode.getElementsByTagName("*")[0]!==a},"last-child":function(a){for(;(a=a.nextSibling)&&1!==a.nodeType;);return!!a},root:function(a){return"html"!==a.nodeName.toLowerCase()},"nth-child":function(a,e){var b=a.nodeIndex||0,d=e[3]=e[3]?("%"===e[2]?-1:1)*e[3]:0;e=e[1];if(b)return!((b+
d)%e);var h=a.parentNode.firstChild;b++;do if(1===h.nodeType&&(h.nodeIndex=++b)&&a===h&&(b+d)%e)return 0;while(h=h.nextSibling);return 1},"nth-last-child":function(a,e){var b=a.nodeIndexLast||0,d=e[3]?("%"===e[2]?-1:1)*e[3]:0;e=e[1];if(b)return!((b+d)%e);var h=a.parentNode.lastChild;b++;do if(1===h.nodeType&&(h.nodeLastIndex=b++)&&a===h&&(b+d)%e)return 0;while(h=h.previousSibling);return 1},empty:function(a){return!!a.firstChild},parent:function(a){return!a.firstChild},"only-child":function(a){return 1!==
a.parentNode.getElementsByTagName("*").length},checked:function(a){return!a.checked},lang:function(a,e){return a.lang!==e&&B.documentElement.lang!==e},enabled:function(a){return a.disabled||"hidden"===a.type},disabled:function(a){return!a.disabled},selected:function(a){return!a.selected}},T={},r=function(a){return T[a]||(T[a]=new RegExp("(^| +)"+a+"($| +)"))},y={"":function(a,e){return null!==t(a,e)},"=":function(a,e,b){var d;return(d=t(a,e))&&d===b},"&=":function(a,e,b){var d;return(d=t(a,e))&&r(b).test(d)},
"^=":function(a,e,b){var d;return(d=t(a,e)+"")&&!d.indexOf(b)},"$=":function(a,e,b){var d;return(d=t(a,e)+"")&&d.indexOf(b)===d.length-b.length},"*=":function(a,e,b){var d;return(d=t(a,e)+"")&&-1!==d.indexOf(b)},"|=":function(a,e,b){var d;return(d=t(a,e)+"")&&(d===b||!!d.indexOf(b+"-"))},"!=":function(a,e,b){var d;return!(d=t(a,e))||!r(b).test(d)}};return function(v,r){r=r||B;var D=[],C=null,T,u,F;if(m&&r.querySelectorAll)try{D=Z(r.querySelectorAll(v.replace(a,'="$1"')))}catch(Ia){M(Ia),C=!0}if(!m||
C)if(c.test(v))switch(C=0,v.charAt(0)){case "#":C=v.slice(1);D=B.getElementById(C);D.id!==C&&(D=B.all[C]);D=D?[D]:[];break;case ".":v=v.slice(1);if(x)D=Z((D=r.getElementsByClassName(v)).length?D:[]);else{v=" "+v+" ";var z=r.getElementsByTagName("*");for(T=0;r=z[T++];)-1!==(" "+r.className+" ").indexOf(v)&&(D[C++]=r);D=C?D:[]}break;case ":":z=r.getElementsByTagName("*");T=0;var A=v.replace(n,"$1");for(u=v.replace(q,"");r=z[T++];)w[u]&&!w[u](r,A)&&(D[C++]=r);D=C?D:[];break;case "[":z=r.getElementsByTagName("*");
T=0;r=p.exec(v);v=r[1];var t=r[2]||"";for(F=r[3];r=z[T++];)y[t]&&(y[t](r,v,F)||"class"===v&&y[t](r,"className",F))&&(D[C++]=r);D=C?D:[];break;default:D=Z((D=r.getElementsByTagName(v)).length?D:[])}else{for(var K=v.split(b),N=K.length-1,R=!!N,P,Q,G,O,H,I,J,L,V,E,S,U;C=K[N--];){Q=(P=C.replace(d,"$1%").replace(f,"$1&").replace(k," $1 ").split(g)).length;T=0;O=" ";for(z=r instanceof DocumentFragment?r.children:[r];G=P[T++];)if(" "!==G&&">"!==G&&"~"!==G&&"+"!==G&&z){G=G.match(e);H=G[1]||"*";I=G[2];J=G[3]?
" "+G[3]+" ":"";v=G[4];t=G[5]||"";u=G[7];A="nth-child"===u||"nth-last-child"===u?h.exec("even"===G[8]&&"2n"||"odd"===G[8]&&"2n%1"||!l.test(G[8])&&"0n%"+G[8]||G[8]):G[8];L=[];C=V=0;for(S=T===Q;E=z[V++];)switch(O){case " ":if(E.getElementsByTagName)for(U=E.getElementsByTagName(H),E=0;F=U[E++];)I&&F.id!==I||J&&-1==(" "+F.className+" ").indexOf(J)||!(!v||y[t]&&(y[t](F,v,G[6])||"class"===v&&y[t](F,"className",G[6])))||F.yeasss||(w[u]?w[u](F,A):u)||(S&&(F.yeasss=1),L[C++]=F);break;case "~":for(H=H.toLowerCase();(E=
E.nextSibling)&&!E.yeasss;)1!==E.nodeType||"*"!==H&&E.nodeName.toLowerCase()!==H||I&&E.id!==I||J&&-1===(" "+E.className+" ").indexOf(J)||!(!v||y[t]&&(y[t](F,v,G[6])||"class"===v&&y[t](F,"className",G[6])))||E.yeasss||(w[u]?w[u](E,A):u)||(S&&(E.yeasss=1),L[C++]=E);break;case "+":for(;(E=E.nextSibling)&&1!==E.nodeType;);!E||E.nodeName.toLowerCase()!==H.toLowerCase()&&"*"!==H||I&&E.id!==I||J&&-1===(" "+F.className+" ").indexOf(J)||!(!v||y[t]&&(y[t](F,v,G[6])||"class"===v&&y[t](F,"className",G[6])))||
E.yeasss||(w[u]?w[u](E,A):u)||(S&&(E.yeasss=1),L[C++]=E);break;case ">":if(E.getElementsByTagName)for(U=E.getElementsByTagName(H),T=0;F=U[T++];)F.parentNode!==E||I&&F.id!==I||J&&-1==(" "+F.className+" ").indexOf(J)||!(!v||y[t]&&(y[t](F,v,G[6])||"class"===v&&y[t](F,"className",G[6])))||F.yeasss||(w[u]?w[u](F,A):u)||(S&&(F.yeasss=1),L[C++]=F)}z=L}else O=G;if(R){if(!z.concat){L=[];for(E=0;F=z[E];)L[E++]=F;z=L}D=z.concat(1===D.length?D[0]:D)}else D=z}for(C=D.length;C--;)D[C].yeasss=D[C].nodeIndex=D[C].nodeIndexLast=
null}return D}}(),da=m.lib.Promise=function(){var c=[],a=!1,b="undefined"!==typeof process?process.nextTick:function(a){setTimeout(a,0)},d=function(){a=!0;var e=c.shift();b(function(){e[0].apply(e[1],e[2]);c.length?d():a=!1},0)},f=function(e,b,f){f=f||[];c.push([e,b,f]);a||d()},k=function(a,b){return function(e){try{b.resolve(a(e))}catch(n){b.reject(n)}}},g=function(a,b){if(a instanceof g)return a;if(!(this instanceof g))return new g(a,b);var e;this._fulfills=[];this._rejects=[];this._dones=[];this._fails=
[];if(0<arguments.length)if(e=U(a))a instanceof g?a.then(this.resolve.bind(this),this.reject.bind(this)):(new g(e,a)).then(this.resolve.bind(this),this.reject.bind(this));else if(u(a))try{a.call(b,this.resolve.bind(this),this.reject.bind(this))}catch(n){this.reject(n)}else this.resolve(a)};A(g.prototype,{_state:0,_fulfills:null,_rejects:null,_dones:null,_fails:null,_wait:0,_value:null,_reason:null,_triggered:!1,isPending:function(){return 0===this._state},isFulfilled:function(){return 1===this._state},
isResolved:function(){return 1===this._state},isRejected:function(){return 2===this._state},hasListeners:function(){var a=[this._fulfills,this._rejects,this._dones,this._fails],b;var d=0;for(b=a.length;d<b;d++)if(a[d]&&a[d].length)return!0;return!1},_cleanup:function(){this._fails=this._dones=this._rejects=this._fulfills=null},_processValue:function(a,b,d){var e;if(0===this._state)if(a===this)this._doReject(new TypeError("cannot resolve promise with itself"));else{if(d)try{if(e=U(a)){a instanceof
g?a.then(this._processResolveValue.bind(this),this._processRejectReason.bind(this)):(new g(e,a)).then(this._processResolveValue.bind(this),this._processRejectReason.bind(this));return}}catch(q){0===this._state&&this._doReject(q);return}b.call(this,a)}},_callResolveHandlers:function(){this._done();for(var a=this._fulfills,b;b=a.shift();)f(b[0],b[1],[this._value]);this._cleanup()},_doResolve:function(a){this._value=a;this._state=1;0===this._wait&&this._callResolveHandlers()},_processResolveValue:function(a){this._processValue(a,
this._doResolve,!0)},resolve:function(a){if(this._triggered)return this;this._triggered=!0;this._processResolveValue(a);return this},_callRejectHandlers:function(){this._fail();for(var a=this._rejects,b;b=a.shift();)f(b[0],b[1],[this._reason]);this._cleanup()},_doReject:function(a){this._state=2;this._reason=a;0===this._wait&&this._callRejectHandlers()},_processRejectReason:function(a){this._processValue(a,this._doReject,!1)},reject:function(a){if(this._triggered)return this;this._triggered=!0;this._processRejectReason(a);
return this},then:function(a,b,d){var e=new g,h=this._state;d&&(a&&(a=a.bind(d)),b&&(b=b.bind(d)));0===h||0!==this._wait?(a&&u(a)?this._fulfills.push([k(a,e),null]):this._fulfills.push([e.resolve,e]),b&&u(b)?this._rejects.push([k(b,e),null]):this._rejects.push([e.reject,e])):1===h?a&&u(a)?f(k(a,e),null,[this._value]):e.resolve(this._value):2===h&&(b&&u(b)?f(k(b,e),null,[this._reason]):e.reject(this._reason));return e},"catch":function(a){return this.then(null,a)},_done:function(){for(var a=this._dones,
b;b=a.shift();)try{b[0].call(b[1]||null,this._value)}catch(l){M(l)}},done:function(a,b){var e=this._state;if(1===e&&0===this._wait)try{a.call(b||null,this._value)}catch(n){M(n)}else 0===e&&this._dones.push([a,b]);return this},_fail:function(){for(var a=this._fails,b;b=a.shift();)try{b[0].call(b[1]||null,this._reason)}catch(l){M(l)}},fail:function(a,b){var e=this._state;if(2===e&&0===this._wait)try{a.call(b||null,this._reason)}catch(n){M(n)}else 0===e&&this._fails.push([a,b]);return this},always:function(a,
b){this.done(a,b);this.fail(a,b);return this},promise:function(){return{then:this.then.bind(this),done:this.done.bind(this),fail:this.fail.bind(this),always:this.always.bind(this),"catch":this["catch"].bind(this)}},after:function(a){var e=this;if(U(a)){e._wait++;var b=function(){e._wait--;0===e._wait&&0!==e._state&&(1===e._state?e._callResolveHandlers():e._callRejectHandlers())};u(a.done)?a.done(b):a.then(b)}return e}},!0,!1);g.fcall=function(a,b,d){return g.resolve(a.apply(b,d||[]))};g.resolve=function(a){var e=
new g;e.resolve(a);return e};g.reject=function(a){var e=new g;e.reject(a);return e};g.all=function(a){if(!a.length)return g.resolve(null);var e=new g,b=a.length,d=Array(b),c=b,f,k,x=function(a,b){d[b]=a;c--;0===c&&e.resolve(d)};for(f=0;f<b;f++)(function(b){k=a[f];k instanceof g?k.done(function(a){x(a,b)}).fail(e.reject,e):U(k)||u(k)?(new g(k)).done(function(a){x(a,b)}).fail(e.reject,e):x(k,b)})(f);return e};g.when=function(){return g.all(arguments)};g.allResolved=function(a){if(!a.length)return g.resolve(null);
var e=new g,b=a.length,d=[],c=b,f,k=function(a){d.push(a);x()},x=function(){c--;0===c&&e.resolve(d)};for(f=0;f<b;f++){var v=a[f];v instanceof g?v.done(k).fail(x):U(v)||u(v)?(new g(v)).done(k).fail(x):k(v)}return e};g.race=function(a){if(!a.length)return g.resolve(null);var e=new g,b=a.length,d;for(d=0;d<b;d++){var c=a[d];c instanceof g?c.done(e.resolve,e).fail(e.reject,e):U(c)||u(c)?(new g(c)).done(e.resolve,e).fail(e.reject,e):e.resolve(c);if(!e.isPending())break}return e};g.waterfall=function(a){if(!a.length)return g.resolve(null);
var e=a.shift();e=u(e)?g.fcall(e):g.resolve(b);for(var b;b=a.shift();)U(b)?e=e.then(function(a){return function(){return a}}(b)):u(b)?e=e.then(b):e.resolve(b);return e};g.forEach=function(a,b,d,c){var e=a.slice(),f=new g,h=[],l=0,k=function(){if(e.length){var a=e.shift(),p=l;l++;g.fcall(b,d,[a,p]).done(function(a){h.push(a);k()}).fail(function(a){c?f.reject(a):(h.push(null),k())})}else f.resolve(h)};k();return f};g.counter=function(a){var e=new g;e.countdown=function(){a--;0===a&&e.resolve()};return e};
return g}(),Ja=m.mixin.Promise={$$promise:null,$beforeInit:function(){this.$$promise=new da},then:function(){return this.$$promise.then.apply(this.$$promise,arguments)},done:function(){this.$$promise.done.apply(this.$$promise,arguments);return this},always:function(){this.$$promise.always.apply(this.$$promise,arguments);return this},fail:function(){this.$$promise.fail.apply(this.$$promise,arguments);return this}},wa=m.lib.ObservableEvent=function(){var c=function(a,b){this.name=a;this.listeners=[];
this.map={};this.hash=fa();this.uni="$$"+a+"_"+this.hash;this.suspended=!1;this.lid=0;"object"===typeof b&&null!==b?A(this,b,!0,!1):this.returnResult=b};A(c.prototype,{name:null,listeners:null,map:null,hash:null,uni:null,suspended:!1,lid:null,returnResult:null,autoTrigger:null,lastTrigger:null,triggerFilter:null,filterContext:null,expectPromises:!1,resolvePromises:!1,getName:function(){return this.name},$destroy:function(){for(var a in this)this[a]=null},on:function(a,b,d){if(!a)return null;b=b||
null;d=d||{};var c=this.uni,k=a[c]||++this.lid,g=c+"_"+k,e=d.first||!1;if(a[c]&&(!b||b[g])&&!d.allowDupes)return null;a[c]||(a[c]=k);b&&!b[g]&&(b[g]=!0);a={fn:a,context:b,id:k,async:!1,called:0,limit:0,start:1,count:0,append:null,prepend:null};A(a,d,!0,!1);!0===a.async&&(a.async=1);e?this.listeners.unshift(a):this.listeners.push(a);this.map[k]=a;if(this.autoTrigger&&this.lastTrigger&&!this.suspended){var h=this.triggerFilter;this.triggerFilter=function(a){return a.id===k?h?!1!==h(a):!0:!1};this.trigger.apply(this,
this.lastTrigger);this.triggerFilter=h}return k},once:function(a,b,d){d=d||{};d.limit=1;return this.on(a,b,d)},un:function(a,b){var d=-1,c=this.uni,k=this.listeners;var g=a==parseInt(a)?parseInt(a):a[c];if(!g)return!1;var e=c+"_"+g;b=b||null;for(var h=0,l=k.length;h<l;h++)if(k[h].id===g&&k[h].context===b){d=h;delete a[c];b&&delete b[e];break}if(-1===d)return!1;k.splice(d,1);delete this.map[g];return!0},hasListener:function(a,b){var d=this.listeners;if(a){a=u(a)?a[this.uni]:parseInt(a);if(!a)return!1;
for(var c=this.uni+"_"+a,k=0,g=d.length;k<g;k++)if(d[k].id===a&&(!b||b[c]))return!0;return!1}return 0<d.length},removeAllListeners:function(){var a=this.listeners,b=this.uni,d;var c=0;for(d=a.length;c<d;c++){var k=b+"_"+a[c].fn[b];delete a[c].fn[b];a[c].context&&delete a[c].context[k]}this.listeners=[];this.map={}},suspend:function(){this.suspended=!0},resume:function(){this.suspended=!1},_prepareArgs:function(a,b){if(a.append||a.prepend)b=b.slice(),a.prepend&&(b=a.prepend.concat(b)),a.append&&(b=
b.concat(a.append));return b},trigger:function(){var a=this,b=a.listeners,d=a.returnResult,c=a.triggerFilter,k=a.filterContext,g=a.expectPromises,e=a.keepPromiseOrder,h=[],l=Z(arguments),n;if(a.suspended)return null;a.autoTrigger&&(a.lastTrigger=l.slice());if(0===b.length)return null;var q="all"===d||"concat"===d?[]:"merge"===d?{}:null,p;var B="first"===d?[b[0]]:b.slice();for(g&&"last"===d&&(e=!0);p=B.shift();)if(!(!p||!a.map[p.id]||(b=a._prepareArgs(p,l),c&&!1===c.call(k,p,b,a))||p.filter&&!1===
p.filter.apply(p.filterContext||p.context,b)||(p.count++,p.count<p.start))){if(p.async&&!g){var x=null;I(p.fn,p.context,b,p.async)}else g?(x=function(e,b,d){return function(c){"pipe"===b&&(d[0]=c,d=a._prepareArgs(e,d));return e.fn.apply(e.context,d)}}(p,d,l.slice()),x=n?n.then(x):p.fn.apply(p.context,b),x.catch(M)):x=p.fn.apply(p.context,b);p.called++;p.called===p.limit&&a.un(p.id);if("first"===d)return x;if(g)h.push(x),("pipe"===d||e)&&x&&(n=x);else if(null!==d)if("all"===d)q.push(x);else if("concat"===
d&&x)q=q.concat(x);else if("merge"===d)A(q,x,!0,!1);else{if("nonempty"===d&&x)return x;if("pipe"===d)q=x,l[0]=x;else if("last"===d)q=x;else{if(!1===d&&!1===x)return!1;if(!0===d&&!0===x)return!0}}}if(g){if("pipe"===d)return n;c=Promise.all(h);a.resolvePromises&&null!==d&&"all"!==d&&(c=c.then(function(a){var e,b=a.length;for(e=0;e<b;e++){var c=a[e];if("concat"===d&&c)q=q.concat(c);else if("merge"===d)A(q,c,!0,!1);else{if("nonempty"===d&&c)return c;if("last"===d)q=c;else{if(!1===d&&!1===c)return!1;if(!0===
d&&!0===c)return!0}}}return q}));return c}return q}},!0,!1);return c}(),xa=m.lib.Observable=function(){var c=function(){this.events={}};A(c.prototype,{createEvent:function(a,b){a=a.toLowerCase();var d=this.events;d[a]||(d[a]=new wa(a,b));return d[a]},getEvent:function(a){a=a.toLowerCase();return this.events[a]},on:function(a,b,d,c){a=a.toLowerCase();var f=this.events;f[a]||(f[a]=new wa(a));return f[a].on(b,d,c)},once:function(a,b,d,c){c=c||{};c.limit=1;return this.on(a,b,d,c)},un:function(a,b,d){a=
a.toLowerCase();var c=this.events;c[a]&&c[a].un(b,d)},relayEvent:function(a,b){a.on(b,this.trigger,this,{prepend:"*"===b?null:[b]})},unrelayEvent:function(a,b){a.un(b,this.trigger,this)},hasListener:function(a,b,d){var c=this.events;if(a)return a=a.toLowerCase(),c[a]?c[a].hasListener(b,d):!1;for(a in c)if(c[a].hasListener())return!0;return!1},hasEvent:function(a){return!!this.events[a]},removeAllListeners:function(a){var b=this.events;if(a)b[a]&&b[a].removeAllListeners();else for(a in b)b[a].removeAllListeners()},
trigger:function(){var a=arguments[0],b=this.events,d=null;a=a.toLowerCase();if(b[a]){var c=b[a];d=c.trigger.apply(c,Z(arguments).slice(1))}(c=b["*"])&&c.trigger.apply(c,arguments);return d},suspendEvent:function(a){a=a.toLowerCase();var b=this.events;b[a]&&b[a].suspend()},suspendAllEvents:function(){var a=this.events,b;for(b in a)a[b].suspend()},resumeEvent:function(a){a=a.toLowerCase();var b=this.events;b[a]&&b[a].resume()},resumeAllEvents:function(){var a=this.events,b;for(b in a)a[b].resume()},
destroyEvent:function(a){var b=this.events;b[a]&&(b[a].removeAllListeners(),b[a].$destroy(),delete b[a])},$destroy:function(){var a=this.events,b;for(b in a)this.destroyEvent(b);for(b in this)this[b]=null},getApi:function(){if(!this.api){for(var a="createEvent getEvent on un once hasListener removeAllListeners trigger suspendEvent suspendAllEvents resumeEvent resumeAllEvents destroyEvent relayEvent unrelayEvent".split(" "),b={},d,c=-1,k=a.length;++c<k;d=a[c],b[d]=this[d].bind(this));this.api=b}return this.api}},
!0,!1);return c}(),Q=m.dom.setAttr=function(c,a,b){return c.setAttribute(a,b)};m.ajax=m.ajax||{transport:{}};var ya=m.ajax.serializeParam=function(){function c(a,f,k){var d;if(S(f)){var e=0;for(d=f.length;e<d;e++){var h=f[e];b.test(a)?k(a,h):c(a+"["+("object"===typeof h?e:"")+"]",h,k)}}else if(ca(f))for(e in f)c(a+"["+e+"]",f[e],k);else k(a,f)}var a=/%20/g,b=/\[\]$/;return function(b){var d,k=[],g=function(a,b){b=u(b)?b():null==b?"":b;k[k.length]=encodeURIComponent(a)+"="+encodeURIComponent(b)};for(d in b)c(d,
b[d],g);return k.join("&").replace(a,"+")}}(),Ka=m.ajax.transport.XHR=function(){var c={xml:"application/xml, text/xml",html:"text/html",script:"text/javascript, application/javascript",json:"application/json, text/javascript",text:"text/plain",_default:"*/*"};return J({type:"xhr",_xhr:null,_deferred:null,_ajax:null,$init:function(a,b,d){var c;window.XMLHttpRequest&&(c=new XMLHttpRequest)||(c=new ActiveXObject("Msxml2.XMLHTTP"));this._xhr=c;this._deferred=b;this._opt=a;this._ajax=d;a.progress&&(c.onprogress=
a.progress.bind(a.context));a.uploadProgress&&c.upload&&(c.upload.onprogress=a.uploadProgress.bind(a.context));c.onreadystatechange=this.onReadyStateChange.bind(this)},setHeaders:function(){var a=this._opt,b=this._xhr,d;if(a.xhrFields)for(d in a.xhrFields)b[d]=a.xhrFields[d];a.data&&a.contentType&&b.setRequestHeader("Content-Type",a.contentTypeHeader||a.contentType);b.setRequestHeader("X-Requested-With","XMLHttpRequest");b.setRequestHeader("Accept",a.dataType&&c[a.dataType]?c[a.dataType]+", */*; q=0.01":
c._default);for(d in a.headers)b.setRequestHeader(d,a.headers[d])},onReadyStateChange:function(){var a=this._xhr,b=this._deferred;if(0===a.readyState)a.onreadystatechange=O,b.resolve(a);else if(4===a.readyState){a.onreadystatechange=O;a:{try{var d=!a.status&&location&&"file:"===location.protocol||200<=a.status&&300>a.status||304===a.status||1223===a.status;break a}catch(f){M(f)}d=!1}if(d)this._ajax.processResponse(z(a.responseText)?a.responseText:void 0,a.getResponseHeader("content-type")||"");else{a.responseData=
null;try{a.responseData=this._ajax.returnResponse(z(a.responseText)?a.responseText:void 0,a.getResponseHeader("content-type")||"")}catch(f){M(thrownError)}b.reject(a)}}},abort:function(){this._xhr.onreadystatechange=O;this._xhr.abort()},send:function(){var a=this._opt;try{this._xhr.open(a.method,a.url,!0,a.username,a.password),this.setHeaders(),this._xhr.send(a.data)}catch(b){M(b),this._deferred&&this._deferred.reject(b)}}})}(),La=m.lib.DomEvent=function(){var c=function d(b){if(b instanceof d)return b;
if(!(this instanceof d))return new d(b);for(var c in b)if(!this[c])try{this[c]=b[c]}catch(e){}this.originalEvent=b;this.type=b.type;!this.target&&b.srcElement&&(this.target=b.srcElement);var k=b.button;if(void 0===this.pageX&&null!==b.clientX){var g=this.target?this.target.ownerDocument||window.document:window.document;c=g.documentElement;g=g.body;this.pageX=b.clientX+(c&&c.scrollLeft||g&&g.scrollLeft||0)-(c&&c.clientLeft||g&&g.clientLeft||0);this.pageY=b.clientY+(c&&c.scrollTop||g&&g.scrollTop||
0)-(c&&c.clientTop||g&&g.clientTop||0)}this.which||void 0===k||(this.which=k&1?1:k&2?3:k&4?2:0);this.isDefaultPrevented=b.defaultPrevented||void 0===b.defaultPrevented&&!1===b.returnValue?la:ka;this.timeStamp=b&&b.timeStamp||(new Date).getTime()};A(c.prototype,{isDefaultPrevented:ka,isPropagationStopped:ka,isImmediatePropagationStopped:ka,preventDefault:function(){var b=this.originalEvent;this.isDefaultPrevented=la;b.returnValue=!1;b&&b.preventDefault&&b.preventDefault()},stopPropagation:function(){var b=
this.originalEvent;this.isPropagationStopped=la;b.cancelBubble=!0;b&&b.stopPropagation&&b.stopPropagation()},stopImmediatePropagation:function(){var b=this.originalEvent;this.isImmediatePropagationStopped=la;b&&b.stopImmediatePropagation&&b.stopImmediatePropagation();this.stopPropagation()}},!0,!1);return c}(),L=m.dom.normalizeEvent=function(c){return new La(c)},za=function(c){function a(){d=null}var b,d;c=function(c){return function(f){var g=L(f||window.event),e=slice.call(arguments,1),h=0,l=0,k=
0,q=0;g.type="mousewheel";"detail"in g&&(l=-1*g.detail);"wheelDelta"in g&&(l=g.wheelDelta);"wheelDeltaY"in g&&(l=g.wheelDeltaY);"wheelDeltaX"in g&&(h=-1*g.wheelDeltaX);"axis"in g&&g.axis===g.HORIZONTAL_AXIS&&(h=-1*l,l=0);var p=0===l?h:l;"deltaY"in g&&(p=l=-1*g.deltaY);"deltaX"in g&&(h=g.deltaX,0===l&&(p=-1*h));if(0!==l||0!==h){var B=Math.max(Math.abs(l),Math.abs(h));if(!d||B<d)d=B,"mousewheel"===g.type&&0===B%120&&(d/=40);"mousewheel"===g.type&&0===B%120&&(p/=40,h/=40,l/=40);p=Math[1<=p?"floor":"ceil"](p/
d);h=Math[1<=h?"floor":"ceil"](h/d);l=Math[1<=l?"floor":"ceil"](l/d);this.getBoundingClientRect&&(B=this.getBoundingClientRect(),k=g.clientX-B.left,q=g.clientY-B.top);g.deltaX=h;g.deltaY=l;g.deltaFactor=d;g.offsetX=k;g.offsetY=q;g.deltaMode=0;e.unshift(g,p,h,l);b&&clearTimeout(b);b=setTimeout(a,200);return c.apply(this,e)}}};c.events=function(){var a=window.document;return"onwheel"in a||9<=a.documentMode?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"]};return c}(),R=m.dom.addListener=
function(){var c=null,a=null;return function(b,d,f){null===c&&(b.addEventListener?(c="addEventListener",a=""):(c="attachEvent",a="on"));if("mousewheel"==d){f=za(f);d=za.events();var k;var g=0;for(k=d.length;g<k;g++)b[c](a+d[g],f,!1)}else b[c](a+d,f,!1);return f}}(),Ma=m.ajax.transport.Script=J({type:"script",_opt:null,_deferred:null,_ajax:null,_el:null,$init:function(c,a,b){this._opt=c;this._ajax=b;this._deferred=a},send:function(){var c=document.createElement("script");Q(c,"async","async");Q(c,"charset",
"utf-8");Q(c,"src",this._opt.url);R(c,"load",this.onLoad.bind(this));R(c,"error",this.onError.bind(this));document.head.appendChild(c);this._el=c},onLoad:function(c){this._deferred&&this._deferred.resolve(c)},onError:function(c){this._deferred.reject(c)},abort:function(){this._el.parentNode&&this._el.parentNode.removeChild(this._el)},onDestroy:function(){this._el.parentNode&&this._el.parentNode.removeChild(this._el)}}),Na=m.ajax.transport.IFrame=J({type:"iframe",_opt:null,_deferred:null,_ajax:null,
_el:null,_sent:!1,$init:function(c,a,b){this._opt=c;this._ajax=b;this._deferred=a},send:function(){var c=this,a=document.createElement("iframe"),b="frame-"+fa(),d=c._opt.form;Q(a,"id",b);Q(a,"name",b);a.style.display="none";document.body.appendChild(a);Q(d,"action",c._opt.url);Q(d,"target",b);R(a,"load",c.onLoad.bind(c));R(a,"error",c.onError.bind(c));c._el=a;var f=0,k=function(){f++;try{d.submit(),c._sent=!0}catch(g){M(g),2<f?c._deferred.reject(g):I(k,null,[],1E3)}};k()},onLoad:function(){var c=
this._el;if(this._sent&&this._opt&&!this._opt.jsonp)try{var a=c.contentDocument||c.contentWindow.document;var b=a.body.innerHTML;this._ajax.processResponse(b)}catch(d){M(d),this._deferred.reject(d)}},onError:function(c){this._sent&&this._deferred.reject(c)},abort:function(){this._el.parentNode&&this._el.parentNode.removeChild(this._el)},onDestroy:function(){this._el.parentNode&&this._el.parentNode.removeChild(this._el)}}),ea=m.ajax.Ajax=function(){var c=/\?/,a=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,
b=/#.*$/,d=/([?&])_=[^&]*/,f=new xa,k=!(!window||!window.FormData),g=function(a,e,b){var d=e?e.dataType:null;e=e?e.selector:null;if(!z(a))return a;b=b||"";if("xml"===d||!d&&0<=b.indexOf("xml"))return a=ua(a.trim()),e?K(e,a):a;if("html"===d)return a=ua(a,"text/html"),e?K(e,a):a;if("fragment"==d){b=document.createDocumentFragment();d=document.createElement("div");for(d.innerHTML=a;d.firstChild;)b.appendChild(d.firstChild);return b}if("json"===d||!d&&0<=b.indexOf("json"))return JSON.parse(a.trim());
("script"===d||!d&&0<=b.indexOf("javascript"))&&q(a);return a+""},e=function(a){return"/"==a.substr(0,1)?location.protocol+"//"+location.host+a:a},h=function(a,e){a.replace(b,"");if(!e.allowCache){var h=(new Date).getTime();a=d.test(a)?a.replace(d,"$1_="+h):a+(c.test(a)?"&":"?")+"_="+h}!e.data||"POST"==e.method||e.contentType||k&&e.data instanceof window.FormData||(e.data=z(e.data)?e.data:ya(e.data),a+=(c.test(a)?"&":"?")+e.data,e.data=null);return a},l=function(a,e,b){var d;if(!ha(a)&&!u(a)&&b){var c=
document.createElement("input");Q(c,"type","hidden");Q(c,"name",b);Q(c,"value",a);e.appendChild(c)}else if(S(a)&&b)for(c=0,d=a.length;c<d;c++)l(a[c],e,b+"["+c+"]");else if(ha(a))for(c in a)a.hasOwnProperty(c)&&l(a[c],e,b?b+"["+c+"]":c)},n=function(a){for(var e,b,d={},c=0;c<a.elements.length;c++)if(e=a.elements[c],null!==t(e,"name"))if(b="INPUT"===e.nodeName.toUpperCase()?t(e,"type").toUpperCase():"TEXT","FILE"===b)for(b=0;b<e.files.length;d[e.name]=e.files[b++].name);else if("RADIO"!==b&&"CHECKBOX"!==
b||e.checked)d[e.name]=e.value;return ya(d)},q=function(a){var e=eval;a&&(/^[^\S]*use strict/.test(a)?(e=document.createElement("script"),e.text=a,document.head.appendChild(e).parentNode.removeChild(e)):e(a))};return J({$mixins:[Ja],_jsonpName:null,_transport:null,_opt:null,_deferred:null,_promise:null,_timeout:null,_form:null,_removeForm:!1,$init:function(b){b.url&&(b.url=e(b.url));var d=a.exec((window?window.location.href:"").toLowerCase())||[],c=a.exec(b.url.toLowerCase());this._opt=b;!0!==b.crossDomain&&
!0!==b.ignoreCrossDomain&&(b.crossDomain=!(!c||c[1]===d[1]&&c[2]===d[2]&&(c[3]||("http:"===c[1]?"80":"443"))===(d[3]||("http:"===d[1]?"80":"443"))));var g;b.files&&!k&&(b.transport="iframe");"iframe"!=b.transport||b.form?b.form&&(this._form=b.form,"POST"!=b.method||k||(b.transport="iframe")):(this.createForm(),b.form=this._form);if(b.form&&"iframe"!=b.transport&&"POST"==b.method)k?b.data=new FormData(b.form):(b.contentType="application/x-www-form-urlencoded",b.data=n(b.form));else if("json"===b.contentType)b.contentType=
b.contentTypeHeader||"text/plain",b.data=z(b.data)?b.data:JSON.stringify(b.data);else if(ca(b.data)&&"POST"==b.method&&k)for(g in d=b.data,b.data=new FormData,d)b.data.append(g,d[g]);b.files&&this.importFiles();b.url=h(b.url,b);this._transport=g=!b.crossDomain&&"script"!=b.transport||b.form?"iframe"==b.transport?new Na(b,this.$$promise,this):new Ka(b,this.$$promise,this):new Ma(b,this.$$promise,this);this.$$promise.done(function(a){f.trigger("success",a)});this.$$promise.fail(function(a){f.trigger("error",
a)});this.$$promise.always(function(){f.trigger("end")});f.trigger("start");b.timeout&&(this._timeout=setTimeout(this.onTimeout.bind(this),b.timeout));b.jsonp&&this.createJsonp();!1===f.trigger("before-send",b,g)&&this.$$promise.reject();b.beforeSend&&!1===b.beforeSend.call(b.context,b,g)&&this.$$promise.reject();this.$$promise.isPending()?(I(g.send,g),this.$$promise.always(this.asyncDestroy,this)):I(this.asyncDestroy,this,[],1E3)},asyncDestroy:function(){this.$isDestroyed()||(this.$$promise.hasListeners()?
I(this.asyncDestroy,this,[],1E3):this.$destroy())},abort:function(a){this.$$promise.reject(a||"abort");this._transport.abort();return this},onTimeout:function(){this.abort("timeout")},getTransport:function(){return this._transport},createForm:function(){var a=document.createElement("form");a.style.display="none";Q(a,"method",this._opt.method);Q(a,"enctype","multipart/form-data");l(this._opt.data,a,null);document.body.appendChild(a);this._form=a;this._removeForm=!0},importFiles:function(){var a=this._opt,
b=a.files,e=this._form;a=a.data;var d,c;var h=0;for(d=b.length;h<d;h++){var f=b[h];if(S(f)){var g=f[0];f=f[1]}else g=window.File&&f instanceof File?f.uploadName||"upload"+(1<d?"[]":""):f.name||"upload"+(1<d?"[]":"");if(!(window.File&&f instanceof File)){var l=f;f=null}if(e)l&&e.appendChild(l);else if(f)a.append(g,f);else if(l.files&&l.files.length)for(f=0,c=l.files.length;f<c;f++)a.append(g,l.files[f])}},createJsonp:function(){var a=this._opt,b=a.jsonpParam||"callback",e=a.jsonpCallback||"jsonp_"+
fa();a.url+=(c.test(a.url)?"&":"?")+b+"="+e;this._jsonpName=e;"undefined"!=typeof window&&(window[e]=this.jsonpCallback.bind(this));"undefined"!=typeof global&&(global[e]=this.jsonpCallback.bind(this));return e},jsonpCallback:function(a){try{var b=this.processResponseData(a)}catch(x){M(x);this.$$promise&&this.$$promise.reject(x);return}this.$$promise&&this.$$promise.resolve(b)},processResponseData:function(a,b){var e=this._opt;a=g(a,e,b);f.hasListener("process-response")&&f.trigger("process-response",
a,this.$$promise);e.processResponse&&(a=e.processResponse.call(e.context,a,this.$$promise));return a},returnResponse:function(a,b){return this._opt.jsonp?null:this.processResponseData(a,b)},processResponse:function(a,b){var e=this.$$promise;if(this._opt.jsonp)if(a){try{q(a)}catch(w){M(w),e.reject(w)}e.isPending()&&e.reject(Error("jsonp script didn't invoke callback"))}else e.reject(Error("jsonp script is empty"));else{try{var d=this.processResponseData(a,b)}catch(w){M(w);e.reject(w);return}e.resolve(d)}},
onDestroy:function(){this._timeout&&clearTimeout(this._timeout);this._form&&this._form.parentNode&&this._removeForm&&this._form.parentNode.removeChild(this._form);this._transport.$destroy();this._jsonpName&&("undefined"!=typeof window&&delete window[this._jsonpName],"undefined"!=typeof global&&delete global[this._jsonpName])}},{prepareUrl:h,global:f})}(),Oa=function(){var c={url:null,data:null,method:"GET",headers:null,username:null,password:null,dataType:null,timeout:0,contentType:null,contentTypeHeader:null,
xhrFields:null,jsonp:!1,jsonpParam:null,jsonpCallback:null,transport:null,replace:!1,selector:null,form:null,beforeSend:null,progress:null,uploadProgress:null,processResponse:null,context:null,files:null},a={},b=function(b,f){f=f||{};b&&!z(b)?f=b:f.url=b;if(!f.url&&(f.form&&(f.url=t(f.form,"action")),!f.url))throw Error("Must provide url");A(f,a,!1,!0);A(f,c,!1,!0);f.method=f.method?f.method.toUpperCase():f.form?t(f.form,"method").toUpperCase()||"GET":"GET";return new ea(f)};b.setup=function(b){A(a,
b,!0,!0)};b.on=function(){ea.global.on.apply(ea.global,arguments)};b.un=function(){ea.global.un.apply(ea.global,arguments)};b.get=function(a,c){c=c||{};c.method="GET";return b(a,c)};b.post=function(a,c){c=c||{};c.method="POST";return b(a,c)};b.load=function(a,c,k){k=k||{};z(c)||(k=c);k.dataType="fragment";return b(c,k).done(function(b){if(k.replace)for(;a.firstChild;)a.removeChild(a.firstChild);a.appendChild(b)})};b.loadScript=function(a){return b(a,{transport:"script"})};b.submit=function(a,c){c=
c||{};c.form=a;return b(null,c)};b.prepareUrl=function(a,b){return ea.prepareUrl(a,b||{})};return b}(),H=function(){if("undefined"!==typeof window){var c=window;var a=c.requestAnimationFrame||c.webkitRequestAnimationFrame||c.mozRequestAnimationFrame;var b=c.cancelAnimationFrame||c.webkitCancelAnimationFrame||c.mozCancelAnimationFrame||c.webkitCancelRequestAnimationFrame;if(a)return function(c,f,k){var d=a(f||k?function(){c.apply(f,k||[])}:c);return function(){b(d)}}}return function(a,b,c){var d=I(a,
b,c,0);return function(){clearTimeout(d)}}}(),Pa=function(){var c=/((^|[^a-z0-9_$\]\)'"])|(this))(\.)([^0-9])/ig,a=Function,b={},d=0,f={},k=0,g={},e=0,h=function(){1E3<=d&&(b={});1E3<=k&&(f={});1E3<=e&&(g={})};return{createGetter:function(e,h){try{if(!b[e]||h){d++;var f="".concat("try {","return ",e.replace(c,"$2____.$5"),";} catch (thrownError) { /*DEBUG-START*/console.log(thrownError);/*DEBUG-END*/return undefined; }");return h?"function(____) {"+f+"}":b[e]=new a("____",f)}return b[e]}catch(p){return M(p),
O}},createSetter:function(b,e){try{if(!f[b]||e){k++;var d=b.replace(c,"$2____.$5"),h="".concat("try {",d," = $$$$",";} catch (thrownError) { /*DEBUG-START*/console.log(thrownError);/*DEBUG-END*/return undefined; }");return e?"function(____, $$$$) {"+h+"}":f[b]=new a("____","$$$$",h)}return f[b]}catch(B){return M(B),O}},createFunc:function(b,d){try{if(!g[b]||d){e++;var h="".concat("try {",b.replace(c,"$2____.$5"),";} catch (thrownError) { /*DEBUG-START*/console.log(thrownError);/*DEBUG-END*/return undefined; }");
return d?"function(____) {"+h+"}":g[b]=new a("____",h)}return g[b]}catch(p){return M(p),O}},resetCache:h,enableResetCacheInterval:function(){setTimeout(h,1E4)}}}().createGetter;m.dialog=m.dialog||{pointer:{},position:{}};var Aa=m.dom.getClsReg=function(c){c="(?:^|\\s)"+c+"(?!\\S)";var a=pa.global(),b="regex_"+c;return a.get(b)||a.add(b,new RegExp(c))},Ba=m.dom.hasClass=function(c,a){return a?Aa(a).test(c.className):!1},X=m.dom.addClass=function(c,a){a&&!Ba(c,a)&&(c.className+=" "+a)},aa=m.dom.removeClass=
function(c,a){a&&(c.className=c.className.replace(Aa(a),""))},V=m.dom.setStyle=function(c,a,b){if(c&&c.style){var d=c.style,f;"string"===typeof a?(c={},c[a]=b):c=a;for(f in c)d[f]=c[f]}},Qa=m.dom.removeAttr=function(c,a){return c.removeAttribute(a)},Y=m.dom.removeListener=function(){var c=null,a=null;return function(b,d,f){null===c&&(b.removeEventListener?(c="removeEventListener",a=""):(c="detachEvent",a="on"));b[c](a+d,f)}}(),Ra=m.dom.isVisible=function(c){return c&&!(0>=c.offsetWidth||0>=c.offsetHeight)},
ra=m.dom.is=function(c,a){a=K(a,c.parentNode);var b;var d=-1;for(b=a.length;++d<b;)if(a[d]===c)return!0;return!1},ba=m.dom.getStyle=function(c,a,b){if(window.getComputedStyle){if(c===window)return a?b?0:null:{};c=window.getComputedStyle(c,null)}else c=c.currentStyle||c.style||{};a=a?c[a]:c;return b?parseFloat(a)||0:a},Sa=function(){var c;return function(){if(void 0===c){var a=window.document,b=a.createElement("div"),d=a.createElement("div");a=a.body;d.style&&window.getComputedStyle?(b.style.cssText=
"border:0;width:0;height:0;top:0;left:-9999px;margin-top:1px;position:absolute",b.appendChild(d),d.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;display:block;margin-top:1%;top:1%;border:1px;padding:1px;width:4px;position:absolute",d.innerHTML="",a.appendChild(b),d="4px"===window.getComputedStyle(d,null).width,a.removeChild(b),c=d):c=!1}return c}}();P=function(c,a){var b=/^([+-]?(?:d*.|)d+(?:[eE][+-]?d+|))(?!px)[a-z%]+$/i,d=["Top","Right","Bottom","Left"],
f=c?"inner"===c?"padding":"":"content";return function(c,g){if(c===window)return c.document.documentElement["client"+a];if(9===c.nodeType)return g=c.documentElement,Math.max(c.body["scroll"+a],g["scroll"+a],c.body["offset"+a],g["offset"+a],g["client"+a]);a:{var e=a.toLowerCase(),h=f||(!0===g?"margin":"border");g=ba(c);var l=!0,k="width"===e?c.offsetWidth:c.offsetHeight,q="border-box"===g.boxSizing;if(0>=k||null==k){k=c.style[e];if(b.test(k)){g=k;break a}l=q&&(Sa()||k===c.style[e]);k=parseFloat(k)||
0}c=k;h=h||(q?"border":"content");e=h===(l?"border":"content")?4:"width"===e?1:0;for(q=0;4>e;e+=2)"margin"===h&&(q+=parseFloat(g[h+d[e]])),l?("content"===h&&(q-=parseFloat(g["padding"+d[e]])),"margin"!==h&&(q-=parseFloat(g["border"+d[e]+"Width"]))):(q+=parseFloat(g["padding"+d[e]]),"padding"!==h&&(q+=parseFloat(g["border"+d[e]+"Width"])));g=c+q}return g}};var ma=m.dom.getOuterWidth=P("outer","Width"),na=m.dom.getOuterHeight=P("outer","Height"),Ta=m.dom.delegate=function(c,a,b,d){var f=pa.global().get("dom/delegates",
[]),k=a+"-"+b,g=function(b){b=L(b);for(var e=b.target;e;){if(ra(e,a))return d(b);e=e.parentNode}return null};f[k]||(f[k]=[]);f[k].push({el:c,ls:g,fn:d});R(c,b,g)},N=m.dom.data=function(){var c={};return function(a,b,d){a=a._mjsid||(a._mjsid=fa());var f=c[a];return void 0!==d?(f||(f=c[a]={}),f[b]=d):f?f[b]:void 0}}();m.animate=m.animate||{};var sa=m.animate.getPrefixes=function(){var c=["Moz","Webkit","ms","O","Khtml"],a="animationDelay",b="animationDuration",d="transitionDelay",f="transitionDuration",
k="transform",g=null,e=null,h=!1;return function(){if(!h){var l=window.document.createElement("div"),n=!1,q;if(void 0!==l.style.animationName)n=!0;else{var p=0;for(q=c.length;p<q;p++){var m=c[p];if(void 0!==l.style[m+"AnimationName"]){n=!0;a=m+"AnimationDelay";b=m+"AnimationDuration";d=m+"TransitionDelay";f=m+"TransitionDuration";k=m+"Transform";break}}}n&&("ontransitionend"in window?g="transitionend":"onwebkittransitionend"in window&&(g="webkitTransitionEnd"));e=n?{animationDelay:a,animationDuration:b,
transitionDelay:d,transitionDuration:f,transform:k,transitionend:g}:{};h=!0}return e}}(),Ua=m.animate.getDuration=function(){var c=function(a){if(!a)return 0;var b=parseFloat(a);-1===a.indexOf("ms")&&(b*=1E3);return b},a=function(a,b,d){var e,h=b.length;for(e=0;e<h;e++){var f=c(b[e])+c(d[e]);a=Math.max(f,a)}return a},b=!1,d=null,f=null,k=null,g=null;return function(e){!1===b&&(d=(b=sa())?b.animationDuration:null,f=b?b.animationDelay:null,k=b?b.transitionDuration:null,g=b?b.transitionDelay:null);if(!b)return 0;
var c=window.getComputedStyle?window.getComputedStyle(e,null):e.style;e=0;var l=(c[d]||"").split(","),n=(c[f]||"").split(","),q=(c[k]||"").split(",");c=(c[g]||"").split(",");e=Math.max(e,a(e,l,n));return e=Math.max(e,a(e,q,c))}}(),Va=m.animate.isCssSupported=function(){var c=null;return function(){null===c&&(c=!!sa());return c}}(),Ca=m.animate.animate=function(){var c={show:["mjs-show"],hide:["mjs-hide"],enter:["mjs-enter"],leave:["mjs-leave"],move:["mjs-move"]},a=0,b=function(a,b,e){var c=function(){(new Date).getTime()-
b>=e?a():H(c)};H(c)},d=function x(a,e,c,f,n,q,p,m){var h=function(){var b=N(a,"mjsAnimationQueue");return b&&b.length&&b[0].id==p?!1:(n.reject(a),!0)},g=function(){if(!h()){var b=c;c++;if(c===e.length){n.resolve(a);N(a,"mjsAnimationQueue").shift();var f=N(a,"mjsAnimationQueue");f.length?(f=f[0],d(f.el,f.stages,0,f.start,f.deferred,!1,f.id,f.step)):N(a,"mjsAnimationQueue",null)}else N(a,"mjsAnimationQueue")[0].position=c,x(a,e,c,null,n,!1,p,m);aa(a,e[b]);aa(a,e[b]+"-active")}},l=function(){h()||(X(a,
e[c]+"-active"),da.resolve(m&&m(a,c,"active")).done(function(){if(!h()){var e=Ua(a);e?b(g,(new Date).getTime(),e):H(g)}}))},B=function(){h()||(X(a,e[c]),da.waterfall([m&&m(a,c,"start"),function(){return f?f(a):null}]).done(function(){!h()&&H(l)}))};q?H(B):B()},f=function(b,e,h,f){var g=new da,l=N(b,"mjsAnimationQueue")||[],p=++a;if(e){if(z(e))var m=c[e];else if(u(e))var x=e;else if(S(e))if(z(e[0]))m=e;else{var v=e[0];var w=e[1]}if(ca(e)){m=e.stages;x=e.fn;v=e.before;w=e.after;var t=e.options?A({},
e.options):{};var r=e.context||null;var y=e.duration||null;h=h||t.start}if(Va()&&m)return l.push({el:b,stages:m,start:h,step:f,deferred:g,position:0,id:p}),N(b,"mjsAnimationQueue",l),1===l.length&&d(b,m,0,h,g,!0,p,f),g;t=t||{};h&&(t.start=function(){h(b)});t.complete=function(){g.resolve(b)};y&&(t.duration=y);if(x&&u(x))return v&&A(b.style,v,!0,!1),h&&h(b),N(b,"mjsAnimationQueue",x.call(r,b,function(){g.resolve(b)})),g;if(window.jQuery){e=$(b);v&&e.css(v);N(b,"mjsAnimationQueue","stop");if(x&&z(x))return e[x](t),
g;if(w)return e.animate(w,t),g}}h?(x=h(b),U(x)?x.done(function(){g.resolve(b)}):g.resolve(b)):g.resolve(b);return g};f.addAnimationType=function(a,b){c[a]=b};return f}(),Da=m.animate.stop=function(c){var a=N(c,"mjsAnimationQueue");if(S(a)&&a.length){if(a=a[0]){if(a.stages){var b=a.position;var d=a.stages;aa(c,d[b]);aa(c,d[b]+"-active")}a.deferred&&a.deferred.reject(a.el)}}else u(a)?a(c):"stop"===a&&$(c).stop(!0,!0);N(c,"mjsAnimationQueue",null)},Ea=m.mixin.Observable={$$observable:null,$$callbackContext:null,
$$events:null,$beforeInit:function(c){this.$$observable=new xa;this.$initObservable(c)},$initObservable:function(c){var a=this.$$observable,b;if(c&&c.callback){var d=c.callback,f=d.context||d.scope||d.$context,k=A({},this.$$events,d.$events,!0,!1);for(b in k)a.createEvent(b,k[b]);d.context=null;d.scope=null;for(b in d)if(d[b])a.on(b,d[b],f||this);c.callback=null;f&&(this.$$callbackContext=f)}else if(this.$$events)for(b in this.$$events)a.createEvent(b,this.$$events[b])},on:function(){var c=this.$$observable;
return c?c.on.apply(c,arguments):null},un:function(){var c=this.$$observable;return c?c.un.apply(c,arguments):null},once:function(){var c=this.$$observable;return c?c.once.apply(c,arguments):null},trigger:function(){var c=this.$$observable;return c?c.trigger.apply(c,arguments):null},$beforeDestroy:function(){this.$$observable.trigger("before-destroy",this)},$afterDestroy:function(){this.$$observable.trigger("destroy",this);this.$$observable.$destroy();this.$$observable=null}},oa=function(c){var a=
c?"pageYOffset":"pageXOffset",b=c?"scrollTop":"scrollLeft";c=window.document;var d=c.body,f=c.documentElement,k=function(a,b){return 0>a&&!1===b?0:a};var g=void 0!==window[a]?function(){return window[a]}:f.clientHeight?function(){return f[b]}:function(){return d[b]};return function(a,c){return a&&a!==window?a&&1==a.nodeType&&a!==d&&a!==f?k(a[b],c):k(g(),c):k(g(),c)}},ta=m.dom.getScrollLeft=oa(!0);m.dom.getScrollLeft=oa(!1);var Wa=m.dom.getWidth=P("","Width"),Xa=m.dom.getHeight=P("","Height");P=m.dialog.position.Abstract=
J({dialog:null,positionBase:null,correct:"solid",$init:function(c){this.dialog=c;A(this,c.getCfg().position,!0,!1);this.onWindowResizeDelegate=this.onWindowResize.bind(this);this.onWindowScrollDelegate=this.onWindowScroll.bind(this);var a=this.preferredType||this.type;if("string"==typeof a){var b=this.getAllPositions(),d;-1!=(d=b.indexOf(a))&&(b.splice(d,1),b.unshift(a));this.preferredType=b}else a||(this.preferredType=this.getAllPositions());c.on("reposition",this.onReposition,this);c.on("show-after-delay",
this.onShowAfterDelay,this);c.on("hide-after-delay",this.onHideAfterDelay,this);if(c.isVisible())this.onShowAfterDelay()},getPositionBase:function(){if(this.positionBase)return this.positionBase;var c;return(c=this.dialog.getCfg().position.base)?this.positionBase="string"==typeof c?K(c).shift():c:null},getBoundary:function(){var c=this.getPositionBase(),a=this.screenX||0,b=this.screenY||0;if(c){var d=m.dom.getOffset(c);var f=ma(c);c=na(c);return{x:d.left+a,y:d.top+b,x1:d.left+f-a,y1:d.top+c-b,w:f,
h:c}}f=Wa(window);c=Xa(window);d=m.dom.getScrollTop(window);var k=ta(window);return{x:k+a,y:d+b,x1:k+f-a,y1:d+c-b,w:f,h:c}},getPrimaryPosition:function(c){return!1},getSecondaryPosition:function(c){return!1},getAllPositions:function(){return[]},correctPosition:function(c){var a=this.getPrimaryPosition(),b=this.correct;if(a&&b){var d=this.dialog;a=this.getBoundary();d=d.getDialogSize();var f=this.preferredType,k=f[0];if(b&&"solid"!=b){if(this.type!=k&&this.checkIfFits(c,k,a,d,!1))return this.changeType(k),
this.fitToBoundary(this.getCoords(c),a,d);if(this.checkIfFits(c,this.type,a,d,!1))return this.fitToBoundary(this.getCoords(c),a,d)}if(b&&"position-only"!=b)for(b=0,k=f.length;b<k;b++)if(this.checkIfFits(c,f[b],a,d,!0)){this.changeType(f[b]);break}return this.getCoords(c)}},checkIfFits:function(c,a,b,d,f){c=this.getCoords(c,a,!0);if(!f&&this.getSecondaryPosition(a))return!1;if(f)return!(c.x<b.x||c.y<b.y||c.x+d.width>b.x1||c.y+d.height>b.y1);switch(this.getPrimaryPosition(a)){case "t":return c.y>=b.y;
case "r":return c.x+d.width<=b.x1;case "b":return c.y+d.height<=b.y1;case "l":return c.x>=b.x}},fitToBoundary:function(c,a,b){var d=this.getPositionBase(),f=d?0:a.x,k=d?0:a.y,g=d?a.w:a.x1;a=d?a.h:a.y1;var e=d=0,h=this.dialog.getPointer();c.x<f&&(d=c.x-f,c.x=f);c.y<k&&(e=c.y-k,c.y=k);c.x+b.width>g&&(d=c.x+b.width-g,c.x-=d);c.y+b.height>a&&(e=c.y+b.height-a,c.y-=e);h.setCorrectionOffset(d,e);h.reposition();return c},changeType:function(c){var a=this.dialog.getPointer();this.type=c;a.setType(null,null)},
onReposition:function(c,a){c=!1!==this.screenX||!1!==this.screenY?this.correctPosition(a):this.getCoords(a);this.apply(c)},getCoords:function(c){return{left:0,top:0}},apply:function(c){if(c&&!isNaN(c.x)&&!isNaN(c.y)){var a=this.dialog,b=a.getCfg().position.axis,d={};"y"!=b&&(d.left=c.x+"px");"x"!=b&&(d.top=c.y+"px");V(a.getElem(),d)}},onWindowResize:function(c){this.dialog.reposition(L(c))},onWindowScroll:function(c){this.dialog.reposition(L(c))},onShowAfterDelay:function(){(this.resize||this.screenX||
this.screenY)&&R(window,"resize",this.onWindowResizeDelegate);(this.scroll||this.screenX||this.screenY)&&R(this.dialog.getScrollEl(this.scroll),"scroll",this.onWindowScrollDelegate)},onHideAfterDelay:function(){(this.resize||this.screenX||this.screenY)&&Y(window,"resize",this.onWindowResizeDelegate);(this.scroll||this.screenX||this.screenY)&&Y(this.dialog.getScrollEl(this.scroll),"scroll",this.onWindowScrollDelegate)},onDestroy:function(){var c=this.dialog;Y(window,"resize",this.onWindowResizeDelegate);
Y(c.getScrollEl(this.scroll),"scroll",this.onWindowScrollDelegate);c.un("reposition",this.onReposition,this);c.un("show-after-delay",this.onShowAfterDelay,this);c.un("hide-after-delay",this.onHideAfterDelay,this);if(c.isVisible())this.onHideAfterDelay()}});var Ya=m.dom.isAttached=function b(a){if(a===window)return!0;if(3==a.nodeType)return a.parentElement?b(a.parentElement):!0;var d=window.document.documentElement;return a===d?!0:d.contains(a)};m.dom.getOffet=function(a){var b={top:0,left:0},d=window.document.documentElement;
if(!Ya(a)||a===window)return b;a.getBoundingClientRect&&(b=a.getBoundingClientRect());return{top:b.top+m.dom.getScrollTop()-d.clientTop,left:b.left+ta()-d.clientLeft}};var Za=m.dom.getOffsetParent=function(a){var b=window.document.documentElement;for(a=a.offsetParent||b;a&&a!=b&&"static"===ba(a,"position");)a=a.offsetParent;return a||b},$a=m.dom.getPosition=function(a,b){var d={top:0,left:0},f=window.document.documentElement;if(a===window||a===f)return d;if("fixed"==ba(a,"position"))var k=a.getBoundingClientRect();
else{if(b)return a=m.dom.getOffset(a),d=m.dom.getOffset(b),a={left:a.left-d.left,top:a.top-d.top},0>a.left&&(a.left=0),0>a.top&&(a.top=0),a;b=Za(a);k=m.dom.getOffset(a);b!==f&&(d=m.dom.getOffset(b));d.top+=ba(b,"borderTopWidth",!0);d.left+=ba(b,"borderLeftWidth",!0)}return{top:k.top-d.top-ba(a,"marginTop",!0),left:k.left-d.left-ba(a,"marginLeft",!0)}};oa=m.dialog.position.Target=P.$extend({getCoords:function(a,b,d){var f=this.dialog,k=f.getCfg(),g=f.getTarget();if(!g)return null;b=b||this.type;var e=
this.getPositionBase();a=f.getDialogSize();d=e&&!d?$a(g,e):m.dom.getOffset(g);g=f.getTargetSize();e={};var h=b.substr(0,1),l=b.substr(1),n=k.position.offsetX;k=k.position.offsetY;b=f.pointer.getDialogPositionOffset(b);switch(h){case "t":e.y=d.top-a.height-k;break;case "r":e.x=d.left+g.width+n;break;case "b":e.y=d.top+g.height+k;break;case "l":e.x=d.left-a.width-n}switch(l){case "t":e.y=d.top+k;break;case "r":e.x=d.left+g.width-a.width-n;break;case "b":e.y=d.top+g.height-a.height-k;break;case "l":e.x=
d.left+n;break;case "rc":e.x=d.left+g.width+n;break;case "lc":e.x=d.left-a.width-n;break;case "":switch(h){case "t":case "b":e.x=d.left+g.width/2-a.width/2;break;case "r":case "l":e.y=d.top+g.height/2-a.height/2}}b&&(e.x+=b.x,e.y+=b.y);return e},getPrimaryPosition:function(a){return(a||this.type).substr(0,1)},getSecondaryPosition:function(a){return(a||this.type).substr(1)},getAllPositions:function(){return"t r b l tl tr rt rb br bl lb lt tlc trc brc blc".split(" ")}});m.dialog.position.Mouse=oa.$extend({correct:"position",
$init:function(a){this.onMouseMoveDelegate=this.onMouseMove.bind(this);this.$super(a)},getCoords:function(a,b,d){if(!a)return null;var f=b||this.type,k=this.dialog,g=k.getCfg(),e=k.getDialogSize(),h=this.getPositionBase(),l={};b=(b||this.type).substr(1);var n=g.position.offsetX,q=g.position.offsetY;g=g.position.axis;f=k.getPointer().getDialogPositionOffset(f);var p=0,B=0;!d&&h&&(h=m.dom.getOffset(h),p=h.left,B=h.top);switch(b){case "":l=this.get.call(k.$$callbackContext,k,a,b,d);break;case "c":l.y=
a.pageY-B-e.height/2;l.x=a.pageX-p-e.width/2;break;case "t":l.y=a.pageY-B-e.height-q;l.x=a.pageX-p-e.width/2;break;case "r":l.y=a.pageY-B-e.height/2;l.x=a.pageX-p+n;break;case "b":l.y=a.pageY-B+q;l.x=a.pageX-p-e.width/2;break;case "l":l.y=a.pageY-B-e.height/2;l.x=a.pageX-p-e.width-n;break;case "rt":l.y=a.pageY-B-e.height-q;l.x=a.pageX-p+n;break;case "rb":l.y=a.pageY-B+q;l.x=a.pageX-p+n;break;case "lt":l.y=a.pageY-B-e.height-q;l.x=a.pageX-p-e.width-n;break;case "lb":l.y=a.pageY-B+q,l.x=a.pageX-p-e.width-
n}f&&(l.x+=f.x,l.y+=f.y);g&&(a=this.$super(a,b))&&("x"==g?l.y=a.y:l.x=a.x);return l},onShowAfterDelay:function(){this.$super();R(window.document.documentElement,"mousemove",this.onMouseMoveDelegate)},onHideAfterDelay:function(){this.$super();Y(window.document.documentElement,"mousemove",this.onMouseMoveDelegate)},onMouseMove:function(a){this.dialog.reposition(L(a))},getPrimaryPosition:function(a){return(a||this.type).substr(1,1)},getSecondaryPosition:function(a){return(a||this.type).substr(2)},getAllPositions:function(){return"mt mr mb ml mrt mrb mlb mlt".split(" ")}});
m.dialog.position.Window=P.$extend({getCoords:function(a,b){var d=this.dialog;a=this.getPositionBase()||window;d=d.getDialogSize();var f={};b=(b||this.type).substr(1);var k=this.offsetX,g=this.offsetY,e=m.dom.getScrollTop(a),h=ta(a),l=ma(a);a=na(a);switch(b){case "c":f.y=a/2-d.height/2+e;f.x=l/2-d.width/2+h;break;case "t":f.y=e+g;f.x=l/2-d.width/2+h;break;case "r":f.y=a/2-d.height/2+e;f.x=l-d.width+h-k;break;case "b":f.y=a-d.height+e-g;f.x=l/2-d.width/2+h;break;case "l":f.y=a/2-d.height/2+e;f.x=h+
k;break;case "rt":f.y=e+g;f.x=l-d.width+h-k;break;case "rb":f.y=a-d.height+e-g;f.x=l-d.width+h-k;break;case "lt":f.y=e+g;f.x=h+k;break;case "lb":f.y=a-d.height+e-g,f.x=h+k}return f},getPrimaryPosition:function(a){return(a||this.type).substr(1,1)},getSecondaryPosition:function(a){return(a||this.type).substr(2)},getAllPositions:function(){return"wt wr wb wl wrt wrb wlb wlt wc".split(" ")},correctPosition:function(a){return this.getCoords(a)}});m.dialog.position.Custom=P.$extend({getCoords:function(a){var b=
this.dialog;return this.get.call(b.$$callbackContext,b,a)}});var ab=m.dialog.pointer.Abstract=J({enabled:null,node:null,correctX:0,correctY:0,$init:function(a,b){A(this,b,!0,!1);this.origCfg=b;this.dialog=a;this.opposite={t:"b",r:"l",b:"t",l:"r"};this.names={t:"top",r:"right",b:"bottom",l:"left"};this.sides={t:["l","r"],r:["t","b"],b:["r","l"],l:["b","t"]};this.enabled=!1!==this.enabled&&b.size?!0:!1},enable:function(){this.enabled||(this.enabled=!0,this.render(),this.dialog.isVisible()&&this.dialog.reposition())},
disable:function(){this.enabled&&(this.remove(),this.enabled=!1,this.dialog.isVisible()&&this.dialog.reposition())},getElem:function(){return this.node},getSize:function(){return this.enabled?this.size:0},setCorrectionOffset:function(a,b){this.correctX=a;this.correctY=b},getCorrectionValue:function(a,b,d){if(!b)return 0;var f=d.substr(0,1);d=d.substr(1,1);var k=this.dialog.getDialogSize(),g=this.width,e="t"==f||"b"==f?"width":"height";switch(d){case "":var h=k[e]/2-g/2;var l=-h;break;case "l":l=0;
h=k[e]-g/2;break;case "r":l=-(k[e]-g/2),h=0}b=0>b?Math.max(l,b):Math.min(h,b);return("t"==f||"b"==f)&&"x"==a||("l"==f||"r"==f)&&"y"==a?b:0},getDialogPositionOffset:function(a){var b=(this.detectPointerPosition(a)||"").substr(0,1);a=this.dialog.getPosition().getPrimaryPosition(a);var d={x:0,y:0};if(!this.enabled)return d;b==this.opposite[a]&&(d["t"==b||"b"==b?"y":"x"]="b"==b||"r"==b?-this.size:this.size);return d},detectPointerPosition:function(a){if(this.position&&!a)return u(this.position)?this.position.call(this.dialog.$$callbackContext,
this.dialog,this.origCfg):this.position;var b=this.dialog.getPosition().getPrimaryPosition(a);a=this.dialog.getPosition().getSecondaryPosition(a);var d=a.substr(1,1);if(!b)return null;b=this.opposite[b];a&&(a=a.substr(0,1),b="c"==d?b+this.opposite[a]:b+a);return b},detectPointerDirection:function(a){return this.direction?u(this.direction)?this.direction.call(this.dialog.$$callbackContext,this.dialog,a,this.origCfg):this.direction:a},update:function(){this.remove();this.render();this.append();this.dialog.isVisible()&&
this.dialog.reposition()},setType:function(a,b){this.position=a;this.direction=b;this.update();this.reposition()},render:function(){},onDestroy:function(){this.remove()},reposition:function(){},append:function(){if(this.enabled&&(this.node||this.render(),this.node)){this.reposition();var a=this.dialog.getElem();a&&a.appendChild(this.node)}},remove:function(){var a=this.node;a&&(a.parentNode&&a.parentNode.removeChild(a),this.node=null)}});m.dialog.pointer.Html=function(){var a=null,b={backgroundColor:"transparent",
width:"0px",height:"0px",position:"absolute",fontSize:"0px",lineHeight:"0px"};return ab.$extend({node:null,sub:null,$init:function(b,f){null===a&&(a=window.document.all&&!window.XMLHttpRequest);this.$super(b,f);this.width=this.width||2*this.size;this.inner&&(this.enabled=!0)},createInner:function(){var a=A({},this.origCfg);a.size=this.size-2*this.border;a.width=this.width-4*this.border;a.border=0;a.borderColor=null;a.borderCls=null;a.offset=0;a.inner=this.border;this.sub=new m.dialog.pointer.Html(this.dialog,
a)},getBorders:function(b,f,k){var d={},e=b.substr(0,1);b=f.substr(0,1);var h=f.substr(1);f=a?"dotted":"solid";var l=this.names,n=this.sides,q=this.opposite;d["border"+W(l[q[e]])]=this.size+"px solid "+k;d["border"+W(l[e])]="0 "+f+" transparent";h?(d["border"+W(l[h])]="0 solid transparent",d["border"+W(l[q[h]])]=this.width+"px "+f+" transparent"):(k=Math.floor(this.width/2),d["border"+W(l[n[b][0]])]=k+"px "+f+" transparent",d["border"+W(l[n[b][1]])]=k+"px "+f+" transparent");return d},getOffsets:function(a,
b){var d={},f=this.names,e=this.opposite,h=a.substr(0,1),l="t"==h||"b"==h?"r":"b";d[f[h]]=this.inner?"auto":-this.size+"px";d[f[l]]="auto";if(this.inner)a=b.substr(0,1),b=b.substr(1),d[f[e[l]]]=b?"l"==b||"t"==b?this.inner+"px":-this.width-this.inner+"px":Math.floor(-this.width/2)+"px",d[f[e[a]]]=-(this.size+2*this.inner)+"px";else{switch(a){case "t":case "r":case "b":case "l":b=b!=a?"l"==b||"t"==b?this.offset:-this.width+this.offset:-this.width/2+this.offset;break;case "bl":case "tl":case "lt":case "rt":b=
this.offset;break;default:b=-this.width-this.offset}d["margin"+W(f[e[l]])]=b+"px";switch(a){case "t":case "r":case "b":case "l":b="50%";break;case "tr":case "rb":case "br":case "lb":b="100%";break;default:b=0}d[f[e[l]]]=b;f=sa().transform;e="";l=this.correctX;b=this.correctY;f&&(l&&(e+=" translateX("+this.getCorrectionValue("x",l,a)+"px)"),b&&(e+=" translateY("+this.getCorrectionValue("y",b,a)+"px)"),d[f]=e)}return d},render:function(){if(this.enabled&&!this.node&&this.detectPointerPosition()){this.border&&
!this.sub&&this.createInner();this.node=window.document.createElement("div");var a=window.document.createComment(" ");this.node.appendChild(a);setStyle(this.node,b);X(this.node,this.borderCls||this.cls);this.sub&&(this.sub.render(),this.node.appendChild(this.sub.getElem()))}},reposition:function(){var a=this.detectPointerPosition(),b=this.detectPointerDirection(a);this.node&&(V(this.node,this.getBorders(a,b,this.borderColor||this.color)),V(this.node,this.getOffsets(a,b)),this.sub&&this.sub.reposition())},
update:function(){this.sub&&(this.sub.$destroy(),this.sub=null);this.remove();this.node=null;this.render();this.append();this.dialog.isVisible()&&this.dialog.reposition()},onDestroy:function(){this.sub&&(this.sub.$destroy(),this.sub=null);this.$super()},remove:function(){this.sub&&this.sub.remove();this.$super()}})}();var bb=m.dialog.Overlay=J({dialog:null,enabled:!1,color:"#000",opacity:.5,cls:null,animateShow:!1,animateHide:!1,$mixins:[Ea],$init:function(a){this.dialog=a;this.onClickDelegate=this.onClick.bind(this);
A(this,a.getCfg().overlay,!0,!1);this.$$observable.createEvent("click",!1);this.enabled&&(this.enabled=!1,this.enable())},getElem:function(){this.enabled&&!this.node&&this.render();return this.node},enable:function(){this.enabled||(this.enabled=!0)},disable:function(){this.enabled&&(this.remove(),this.enabled=!1)},show:function(a){this.enabled&&(this.animateShow?this.animate("show",a):this.node.style.display="block")},hide:function(a){this.node&&(this.animateHide?this.animate("hide",a):this.node.style.display=
"none")},render:function(){if(this.enabled){var a=window.document.createElement("div"),b=this.dialog.getCfg();V(a,{display:"none",position:"fixed",left:0,top:0,right:0,bottom:0,opacity:this.opacity,backgroundColor:this.color});R(a,"click",this.onClickDelegate);b.render.zIndex&&V(a,"zIndex",b.render.zIndex);this.cls&&m.dom.addClass(a,this.cls);this.node=a}},remove:function(){var a=this.node;a&&H(function(){a.parentNode&&a.parentNode.removeChild(a)})},append:function(){var a=this.dialog.getCfg().render.appendTo||
window.document.body;this.enabled&&(this.node||this.render(),a.appendChild(this.node))},animate:function(a,b){var d=this.node;var f="show"==a?this.animateShow:this.animateHide;u(f)&&(f=f(this,b));ja(f)?f=a:z(f)&&(f=[f]);return Ca(d,f,function(){if("show"==a)return new da(function(a,b){H(function(){d.style.display="";a()})})},!1)},onClick:function(a){return!1===this.trigger("click",this.dialog,this,a)?null:this.modal?(a=L(a),a.preventDefault(),a.stopPropagation(),!1):null},onDestroy:function(){this.remove()}}),
cb=m.dialog.Manager=J({all:null,groups:null,$init:function(){this.all={};this.groups={}},register:function(a){var b=a.getInstanceId(),d=a.getGroup(),f=this.groups,k;this.all[b]=a;var g=0;for(k=d.length;g<k;g++){var e=d[g];f[e]||(f[e]={});f[e][b]=!0}a.on("destroy",this.unregister,this)},unregister:function(a){a=a.getInstanceId();delete this.all[a]},hideAll:function(a){var b=a.getInstanceId();a=a.getGroup();var d=this.all,f=this.groups,k,g;var e=0;for(k=a.length;e<k;e++){var h=a[e];h=f[h];for(g in h)d[g]?
g==b||d[g].isHideAllIgnored()||d[g].hide(null,!0,!0):delete h[g]}}});m.dialog.Dialog=function(){var a=new cb,b=function(a,b,d,f){if("show"===d||!f)return b.preventDefault(),b.stopPropagation(),!1},d=function(a,b,d,f){var e=a[b],h=!1;if(void 0!==e){switch(f){case "string":h=z(e);break;case "function":h=u(e);break;case "number":h=1===ia(e)||e==parseInt(e);break;case "dom":h=e&&(e.tagName||e.nodeName)?!0:!1;break;case "jquery":(h=e&&e.jquery?!0:!1)&&(e=e.get(0));break;case "boolean":if(!0===e||!1===
e)h=!0;break;default:!0===f&&!0===e&&(h=!0),!1===f&&!1===e&&(h=!0)}h&&(a[b]={},a[b][d]=e)}},f=function(a){if(!a)return{};d(a,"content","value","string");d(a,"content","value","boolean");d(a,"content","fn","function");d(a,"ajax","url","string");d(a,"cls","dialog","string");d(a,"render","tpl","string");d(a,"render","fn","function");d(a,"render","el","dom");d(a,"render","el","jquery");d(a,"show","events",!1);d(a,"show","events","string");d(a,"hide","events",!1);d(a,"hide","events","string");d(a,"toggle",
"events",!1);d(a,"toggle","events","string");d(a,"position","type","string");d(a,"position","type",!1);d(a,"position","get","function");d(a,"overlay","enabled","boolean");d(a,"pointer","position","string");d(a,"pointer","size","number");return a},k={target:null,group:null,modal:!1,useHref:!1,content:{value:"",fn:null,prepare:null,attr:null},ajax:{url:null,data:null,dataType:"text",method:"GET"},cls:{dialog:null,visible:null,hidden:null,loading:null},selector:{content:null},buttons:null,render:{tpl:"<div></div>",
fn:null,el:null,zIndex:null,lazy:!0,style:null,appendTo:null,id:null,keepVisible:!1,keepInDOM:!1,lifetime:null},events:{show:{"*":{process:b}},hide:{"*":{process:b}}},show:{delay:null,single:!1,events:null,animate:!1,ignoreHideAll:!1,focus:!1,preventScroll:!1,display:"block"},hide:{delay:null,timeout:null,events:null,destroy:!1,remove:!1,animate:!1,cancelShowDelay:!0},toggle:{events:null},position:{type:"t",preferredType:null,offsetX:0,offsetY:0,axis:null,get:null,screenX:!1,screenY:!1,base:null,
scroll:!1,resize:!0},pointer:{position:null,direction:null,size:0,width:null,color:null,offset:0,border:0,borderColor:null,el:null,cls:null,borderCls:null},overlay:{enabled:!1,color:"#000",opacity:.5,cls:null,animateShow:!1,animateHide:!1},callback:{context:null,"content-change":null,"before-show":null,show:null,"before-hide":null,hide:null,render:null,lifetime:null,"target-change":null,button:null}},g=J({$mixins:[Ea],id:null,node:null,overlay:null,pointer:null,cfg:null,position:null,target:null,
dynamicTarget:!1,dynamicTargetEl:null,visible:!1,enabled:!0,frozen:!1,rendered:!1,bindSelfOnRender:!1,hideTimeout:null,hideDelay:null,showDelay:null,destroyDelay:null,images:0,positionGetType:null,positionClass:null,positionAttempt:0,$constructor:function(){this.$$events={"before-show":{returnResult:!1},"before-hide":{returnResult:!1}};this.$super.apply(this,arguments)},$init:function(b){b=b||{};var e=b.preset;b.preset=null;this.cfg=b=A({},k,f(g.defaults),f(g[e]),f(b),!0,!0);this.id=fa();this.onPreventScrollDelegate=
this.onPreventScroll.bind(this);this.onButtonClickDelegate=this.onButtonClick.bind(this);this.onButtonKeyupDelegate=this.onButtonKeyup.bind(this);this.showDelegate=this.show.bind(this);this.hideDelegate=this.hide.bind(this);this.toggleDelegate=this.toggle.bind(this);this.onImageLoadDelegate=this.onImageLoad.bind(this);a.register(this);b.modal&&(b.overlay.enabled=!0);this.overlay=new bb(this);e=W(b.pointer.$class||"Html");this.pointer=J.factory("MetaphorJs.dialog.pointer."+e,this,b.pointer);u(b.position.type)&&
(this.positionGetType=b.position.type);this.setTarget(b.target);b.target&&b.useHref&&(e=t(this.getTarget(),"href"),"#"===e.substr(0,1)?b.render.el=e:b.ajax.url=e);b.render.lazy||this.render();this.trigger("init",this);this.setHandlers("bind")},getElem:function(){return this.node},getInstanceId:function(){return this.id},getCfg:function(){return this.cfg},getPointer:function(){return this.pointer},getOverlay:function(){return this.overlay},isEnabled:function(){return this.enabled},isVisible:function(){return this.visible},
isHideAllIgnored:function(){return this.cfg.show.ignoreHideAll},isFrozen:function(){return this.frozen},isRendered:function(){return this.rendered},enable:function(){this.enabled=!0},disable:function(){this.hide();this.enabled=!1},freeze:function(){this.frozen=!0},unfreeze:function(){this.frozen=!1},getGroup:function(){var a=this.cfg;return a.group?z(a.group)?[a.group]:a.group:[""]},toggle:function(a,b){return a&&a.stopPropagation&&this.dynamicTarget&&this.visible&&this.isDynamicTargetChanged(a)?
this.show(a):this[this.visible?"hide":"show"](a,b)},resetHandlers:function(a,b){this.setHandlers("unbind");this.bindSelfOnRender=!1;a&&a.call(b,this,this.getCfg());this.setHandlers("bind")},setHandlers:function(a,b){var e=this.cfg,d=["show","hide","toggle"],h="bind"===a?R:Y;a="bind"===a?Ta:m.dom.undelegate;for(var f,g,k,v,w,u,r,y,t,A;f=d.shift();)if(g=e[f].events,!1!==g){if(z(g)||S(g))this.dynamicTarget?(w={},w[g]=e.target,g={_html:w}):g={_target:g};for(k in g){if(b)if("_self"===b){if("_self"!==k&&
"_overlay"!==k&&">"!==k.substr(0,1))continue}else if(k!==b)continue;if("_self"!==k&&"_overlay"!==k&&">"!==k.substr(0,1)||this.node){if(r=g[k]){switch(k){case "_target":y=[this.getTarget()];break;case "_self":y=[this.node];break;case "_window":y=[window];break;case "_document":y=[window.document];break;case "_html":y=[window.document.documentElement];break;case "_overlay":y=[this.overlay.getElem()];break;default:y=">"===k.substr(0,1)?K(k.substr(1),this.node):K(k)}if(y&&y.length)if(z(r)&&(r=[r]),S(r))for(w=
0,u=r.length;w<u;w++)for(t=-1,A=y.length;++t<A;h(y[t],r[w],this[f+"Delegate"]));else for(v in r)for(t=-1,A=y.length;++t<A;a(y[t],r[v],v,this[f+"Delegate"]));}}else this.bindSelfOnRender=!0}}},onPreventScroll:function(a){L(a).preventDefault()},onButtonClick:function(a){var b=L(a).target;(b=N(b,"metaphorjsTooltip-button-id"))&&this.trigger("button",this,b,a)},onButtonKeyup:function(a){if(13===a.keyCode||32===a.keyCode){var b=N(a.target,"metaphorjsTooltip-button-id");b&&this.trigger("button",this,b,
L(a))}},getEventConfig:function(a,b){var e=this.node;for(var d=a.type,h=a.target,f=null,g;h&&h!==e;){if(g=t(h,"data-"+b+"-"+d)){f=Pa(g)({});break}h=h.parentNode}e=f;d=this.cfg;!e&&d.events[b]&&(e=d.events[b][a.type]||d.events[b]["*"]);return e},show:function(b,d){var e=this.cfg,h=null,f=e.show,g=null;b&&(b=L(b));this.isEnabled()||(g="disabled");!g&&this.visible&&this.hideTimeout&&(window.clearTimeout(this.hideTimeout),this.hideTimeout=I(this.hide,this,null,e.hide.timeout),g="hidetimeout");!g&&this.hideDelay&&
(window.clearTimeout(this.hideDelay),this.hideDelay=null,this.visible=!0,g="hidedelay");!g&&this.frozen&&(g="frozen");this.destroyDelay&&(window.clearTimeout(this.destroyDelay),this.destroyDelay=null);e=!1;b&&this.dynamicTarget&&(e=this.changeDynamicTarget(b));this.visible&&(e?(this.reposition(b),g="reposition"):g=g||"visible");if(!g||e)this.node?e&&this.changeDynamicContent():this.render();g||!1!==this.trigger("before-show",this,b)||(g="beforeshow");var k;b&&(k=this.getEventConfig(b,"show"))&&(k.process?
h=k.process(this,b,"show",g):(k.stopPropagation&&b.stopPropagation(),k.preventDefault&&b.preventDefault(),h=k.returnValue));if(g)return h;Da(this.node);this.visible=!0;f.single&&a.hideAll(this);this.toggleTitleAttribute(!1);f.delay&&!d?this.showDelay=I(this.showAfterDelay,this,[b],f.delay):this.showAfterDelay(b,d);return h},showAfterDelay:function(a,b){var e=this,d=e.cfg;e.showDelay=null;if(e.visible){e.trigger("show-after-delay",e,a);d.hide.remove&&e.appendElem();e.reposition(a);if(d.show.preventScroll){var h=
d.show.preventScroll,f;!0===h&&(h="body");h=K(h);var g=-1;for(f=h.length;++g<f;R(h[g],"mousewheel",e.onPreventScrollDelegate)&&R(h[g],"touchmove",e.onPreventScrollDelegate));}e.overlay.show();d.show.animate&&!b?e.animate("show").done(function(){e.showAfterAnimation(a)}):H(function(){e.showAfterAnimation(a)})}},showAfterAnimation:function(a){var b=this.cfg,e=this.node;this.visible&&(aa(e,b.cls.hidden),X(e,b.cls.visible),b.render.keepVisible||(e.style.display=b.show.display||"block"),b.hide.timeout&&
(this.hideTimeout=I(this.hide,this,null,b.hide.timeout)),b.show.focus&&I(this.setFocus,this,null,20),this.trigger("show",this,a))},hide:function(a,b,d){var e=null,h=null,f=this.cfg;this.hideTimeout=null;!this.visible&&this.hideDelay&&b&&(window.clearTimeout(this.hideDelay),this.hideDelay=null,this.visible=!0);this.node&&this.visible&&this.isEnabled()||(h=this.node?this.visible?"disabled":"hidden":"noelem");this.showDelay&&!h&&(f.hide.cancelShowDelay||d?(window.clearTimeout(this.showDelay),this.showDelay=
null,this.visible=!1,h="cancel"):h="delay");this.frozen&&!h&&(h="frozen");h||!1!==this.trigger("before-hide",this,a)||(h="beforehide");var g;a&&a.stopPropagation&&(g=this.getEventConfig(a,"hide"))&&(g.process?e=g.process(this,a,"hide",h):(g.stopPropagation&&a.stopPropagation(),g.preventDefault&&a.preventDefault(),e=g.returnValue));if(h)return e;Da(this.node);this.visible=!1;this.toggleTitleAttribute(!0);this.dynamicTarget&&this.resetDynamicTarget();f.hide.delay&&!b?this.hideDelay=I(this.hideAfterDelay,
this,[a],f.hide.delay):this.hideAfterDelay(a,b);return e},hideAfterDelay:function(a,b){var e=this,d=e.cfg;e.hideDelay=null;if(!e.visible){e.trigger("hide-after-delay",e,a);if(d.show.preventScroll){var h=d.show.preventScroll,f;!0===h&&(h="body");h=K(h);var g=-1;for(f=h.length;++g<f;Y(h[g],"mousewheel",e.onPreventScrollDelegate)&&Y(h[g],"touchmove",e.onPreventScrollDelegate));}e.overlay.hide();d.hide.animate&&!b?e.animate("hide").done(function(){e.hideAfterAnimation(a)}):H(function(){e.hideAfterAnimation(a)})}},
hideAfterAnimation:function(a){var b=this,e=b.cfg,d=b.node;b.visible||(aa(d,e.cls.visible),X(d,e.cls.hidden),e.render.keepVisible||(d.style.display="none"),b.trigger("hide",b,a),a=e.render.lifetime,null!==a&&(0===a?b.destroyElem():b.destroyDelay=I(b.destroyElem,b,null,a)),d&&e.hide.destroy?H(function(){N(d,e.instanceName,null);b.$destroy()}):d&&e.hide.remove&&H(function(){b.removeElem()}))},render:function(){var a=this.cfg;if(!this.node){var b=a.render,d=a.cls;if(b.fn){var f=b.fn.call(this.$$callbackContext,
this);b[z(f)?"tpl":"el"]=f}b.el?z(b.el)?(f=K(b.el).shift(),b.keepInDOM=!0):f=b.el:(f=window.document.createElement("div"),f.innerHTML=b.tpl,f=f.firstChild);f||(f=window.document.createElement("div"));this.node=f;b.id&&Q(f,"id",b.id);a.render.keepVisible||(f.style.display="none");X(f,d.dialog);X(f,d.hidden);b.style&&V(f,b.style);this.overlay.render();a.hide.remove?f.parentNode&&f.parentNode.removeChild(f):this.appendElem();b.zIndex&&V(f,{zIndex:b.zIndex});b=a.content;if(!1!==b.value)if(b.value)this.setContent(b.value);
else if(b.fn)this.setContent(b.fn.call(this.$$callbackContext,this));else this[a.ajax.url?"loadContent":"readContent"]();this.pointer.render();this.pointer.append();if(a.buttons)for(var g in a.buttons)if(b=K(a.buttons[g],f).shift())N(b,"metaphorjsTooltip-button-id",g),R(b,"click",this.onButtonClickDelegate),R(b,"keyup",this.onButtonKeyupDelegate);this.bindSelfOnRender&&(this.setHandlers("bind","_self"),this.bindSelfOnRender=!1);this.rendered=!0;this.trigger("render",this)}},setPositionType:function(a){var b=
this.getPositionClass(a);this.cfg.position.type=a;this.positionClass===b&&this.position?this.position.type=a:(this.position&&(this.position.$destroy(),this.position=null),b&&(this.position=J.factory(b,this)));this.isVisible()&&this.reposition()},getPosition:function(a){var b=this.cfg.position;if(!this.position){!this.positionGetType&&"custom"!==b.type&&u(b.get)&&"m"!==b.type&&(b.type="custom");a=this.positionGetType?this.positionGetType.call(this.$$callbackContext,this,a):b.type;var e=this.getPositionClass(a);
b.type=a;if(!1===e)return;this.positionClass!==e?this.position=J.factory(e,this):this.position.type=a}return this.position},getPositionClass:function(a){return a?u(a)||"custom"===a?"dialog_position_Custom":(a=a.substr(0,1))?"w"===a?"dialog_position_Window":"m"===a?"dialog_position_Mouse":"dialog_position_Target":!1:!1},reposition:function(a){this.repositioning||(this.repositioning=!0,a&&(a=L(a)),this.getPosition(a),this.trigger("before-reposition",this,a),this.getPosition(a),this.trigger("reposition",
this,a),this.repositioning=!1)},getTarget:function(){return this.dynamicTarget?this.dynamicTargetEl:this.target},setTarget:function(a){if(a){var b=!1,e=this.target;this.target?(this.setHandlers("unbind","_target"),b=!0):this.dynamicTarget&&(b=!0);var d=z(a);d&&"#"!==a.substr(0,1)?(this.dynamicTarget=!0,this.target=null):(d&&(a=K(a).shift()),this.dynamicTarget=!1,this.target=a);b&&(this.setHandlers("bind","_target"),this.trigger("target-change",this,a,e))}},resetDynamicTarget:function(){var a=this.dynamicTargetEl;
a&&(this.setHandlers("unbind","_target"),this.trigger("target-change",this,null,a))},isDynamicTargetChanged:function(a){var b=this.cfg.target;a=a.target;for(var e=this.dynamicTargetEl;a&&!ra(a,b);)a=a.parentNode;return a?!e||e!==a:!1},changeDynamicTarget:function(a){var b=this.cfg.target;a=a.target;for(var e=this.dynamicTargetEl;a&&!ra(a,b);)a=a.parentNode;if(!a||e&&e===a)return!1;e&&this.setHandlers("unbind","_target");this.dynamicTargetEl=a;this.setHandlers("bind","_target");this.trigger("target-change",
this,a,e);return!0},getContentElem:function(){var a=this.node;return a?this.cfg.selector.content?K(this.cfg.selector.content,a).shift()||a:a:null},setContent:function(a,b){b=b||"";var e=this.node,d=this.cfg,f=this.pointer;if(!e)return d.content.value=a,this;d.content.prepare&&(a=d.content.prepare.call(this.$$callbackContext,this,b,a));var g=this.getContentElem(),h=this.rendered&&!d.selector.content&&f;f=h&&f.getElem();if(h&&f)try{e.removeChild(f)}catch(w){M(w)}if(z(a))g.innerHTML=a;else for(var k in a){var m=
d.selector[k];m&&(m=K(m,g).shift())&&(m.innerHTML=a[k])}if(h&&f)try{e.appendChild(f)}catch(w){M(w)}e=K("img",g);this.images=e.length;k=-1;for(d=e.length;++k<d;R(e[k],"load",this.onImageLoadDelegate));this.trigger("content-change",this,a,b);this.onContentChange()},readContent:function(){var a=this.cfg,b=this.getTarget(),d;b&&(d=a.content.attr?t(b,a.content.attr):t(b,"tooltip")||t(b,"title")||t(b,"alt"));d&&this.setContent(d,"attribute")},loadContent:function(a){var b=this.cfg;X(this.node,b.cls.loading);
a=A({},b.ajax,a,!0,!0);this.trigger("before-ajax",this,a);return Oa(a).done(this.onAjaxLoad,this)},onAjaxLoad:function(a){aa(this.node,this.cfg.cls.loading);this.setContent(a,"ajax")},onImageLoad:function(){this.images--;this.onContentChange()},onContentChange:function(){this.visible&&this.reposition()},changeDynamicContent:function(){var a=this.cfg;a.content.fn?this.setContent(a.content.fn.call(this.$$callbackContext,this)):a.content.attr&&this.readContent()},toggleTitleAttribute:function(a){var b=
this.getTarget(),e;b&&(!1===a?(N(b,"tmp-title",t(b,"title")),Qa(b,"title")):(e=N(b,"tmp-title"))&&Q(b,"title",e))},getDialogSize:function(){this.rendered||this.render();var a=this.cfg,b=this.node,d=a.cls.hidden?Ba(b,a.cls.hidden):!Ra(b),f=b.style.left;d&&(V(b,{left:"-1000px"}),b.style.display=a.show.display);a={width:ma(b),height:na(b)};d&&(V(b,{left:f}),b.style.display="none");return a},getTargetSize:function(){var a=this.getTarget();return a?{width:ma(a),height:na(a)}:null},setFocus:function(){var a=
this.cfg,b=a.show.focus,d=this.node,f;if(!0===b)if(b=K("input",d).concat(K("textarea",d)),0<b.length)b[0].focus();else{if(a.buttons)for(f in a.buttons){(a=K(a.buttons[f],d).shift())&&a.focus();break}}else(a=K(b,d).shift())&&a.focus()},getScrollEl:function(a){return!0===a||!1===a?window:"string"===typeof a?K(a).shift():a},animate:function(a,b){var d=this.cfg,e=this.node;var f=d[a].animate;u(f)&&(f=f(this,b));var g=f.skipDisplayChange||!1;ja(f)?f=a:z(f)&&(f=[f]);return Ca(e,f,function(){if("show"===
a&&!g)return new da(function(a,b){H(function(){e.style.display=d.show.display||"block";a()})})},!1)},removeElem:function(){var a=this,b=a.node;a.overlay.remove();b&&b.parentNode&&H(function(){a.visible||b.parentNode.removeChild(b)})},appendElem:function(){var a=this.cfg,b=window.document.body;b=a.render.appendTo||b;this.overlay.append();this.node&&!1!==a.render.appendTo&&b.appendChild(this.node)},destroyElem:function(){var a=this.node;this.setHandlers("unbind","_self");this.bindSelfOnRender=!0;this.pointer.remove();
this.overlay.remove();a&&(this.cfg.render.keepInDOM||a.parentNode&&a.parentNode.removeChild(a),this.node=null);this.trigger("lifetime",this)},onDestroy:function(){this.setHandlers("unbind");this.trigger("destroy",this);this.destroyElem();this.overlay&&this.overlay.$destroy();this.pointer&&this.pointer.$destroy();this.position&&this.position.$destroy()}},{defaults:null});return g}();P={};P.Dialog=m.dialog.Dialog;"undefined"!=typeof global?global.MetaphorJs=P:window.MetaphorJs=P})();
